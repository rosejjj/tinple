<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script type="text/javascript" src="../../script/api.js"></script>
  <title>Document</title>
  <style type="text/css">
  	*{
  		padding:0;
  		margin:0;
  	}
    html{
      font-family: Arial;
    }
  	body{
  		background-color:#aaa;
  		width: 100%;
  		height: 100%;
  	}
  	.box{
      position: fixed;
      bottom:0vw;
  		width: 100%;
      height: auto;
      padding:0 8.51vw 0 8.51vw;
  	}
  	.content{
      width:39.89vw;
  		height: 10.64vw;
  		background-color:#fff;
  		padding-left:5.32vw;
  		border-radius:30px;
  		margin-bottom:3.99vw;
      margin-right:2.66vw;
  		display:flex;
  		align-items: center;
      float:left;
      box-sizing: border-box;
  	}

    .content>img{width: 7.99vw;height: 7.99vw;}
  	.text{
  		font-size: 3.19vw;
      font-weight: bold;
  		text-align: center;
      display: inline-block;
      /*margin-left:1.33vw;*/
      width: 20.94vw;
      white-space: pre-line;
      word-wrap: break-word;
      /*内容超过宽度自动换行，不带空格的全英文和全数字也可以*/
    	}
    .top{
      width: 100%;
      height:95.75vw;
      margin:0 auto;
      margin-top:5.59vw;
      position: relative;
    }
    .topleft{
      position: absolute;
      left:0;
      top:50%;
      margin-top:-3.99vw;
      width:7.99vw;
      height:7.99vw;
      background:url(../../icon/icon-more-left@3x2.png) no-repeat;
      background-size: cover;
    }
    .topright{
      position: absolute;
      right:0;
      top:50%;
      margin-top:-3.99vw;
      width:7.99vw;
      height:7.99vw;
      background:url(../../icon/icon-more-left@3x2.png) no-repeat;
      background-size: cover;
      transform:rotate(180deg);
    }
    .imgbox{
      width: 100%;
      height: 95.75vw;
      /*margin:0 auto;*/
      /*border-radius: 10px;*/
      overflow: hidden;
      position: relative;
    }
    ul{
      width:600%;
      height: 100%;
      /*margin-left:8.77vw;*/
      position: absolute;
    }
    ul li{
      width:82.45vw;
      height:95.75vw;
      float:left;
      list-style: none;
      margin-right:8.775vw;
      margin-left:8.775vw;
    }
    ul li:first-child{
      margin-left:8.775vw;
    }
    ul li:last-child{
        background-color: #fff;
        border-radius: 20px;
      }
    .imgbox img{
      width: 82.45vw;
      height:82.45vw;
      display: inline-block;
      /*object-fit: cover;*/
      vertical-align:bottom;
      background-color:#efefef;
      border-radius: 20px 20px 0 0 ;
      }
    .imgcontent{
        width: 82.45vw;
        height:13.3vw;
        text-align: center;
        font:3.19vw/13.3vw Arial;
        color:#aaa;
        background-color: #fff;
        border-radius: 0 0 20px 20px ;
        padding-right:5vw;
        padding-left:5vw;
        box-sizing: border-box;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .imgend{
        width:26.6vw;
        height:7.99vw;
        background-color: #F381A3;
        font:3.19vw/7.99vw Arial;
        color:#fff;
        font-weight: bold;
        text-align: center;
        border-radius: 5px;
        margin:45.88vw auto 0;
      }
      .loading{
          width: 18.62vw;
          text-align: center;
          height: 13.30vw;
          position: fixed;
          top: 50.67vw;
          left: 50%;
          transform: translateX(-50%);
          background: #fff;
          border-radius:2.66vw;
          opacity: 0.5;
        }
        .loading img{
          position: absolute;
          bottom:2.66vw;
          left:50%;
          margin-left:-4vw;
          width:8vw;
          height:8vw;
        }
  </style>
</head>
<body>
  <div class="top">
    <div class="loading">
        <img src="../../icon/loading.gif"/>
      </div>
    <div class="imgbox" id="imgbox">
      <ul id="lunbo">
 <!--        <li><img class="lunbo" src="../../image/enbozu.png" alt=""><div class="imgcontent">7.25 | SMS System Upgrade ... &gt;&gt;</div></li>
        <li><img class="lunbo" src="../../image/enbozu.png" alt=""><div class="imgcontent">7.25 | SMS System Upgrade ... &gt;&gt;</div></li>
        <li><img class="lunbo" src="../../image/enbozu.png" alt=""><div class="imgcontent">7.25 | SMS System Upgrade ... &gt;&gt;</div></li>
        <li><div class="imgend" onclick="openlist()">V I E W   A L L</div></li> -->
      </ul>

    </div>
    <div class="topleft" id="topleft"></div>
    <div class="topright" id="topright"></div>
  </div>
	<div class="box">
	  <div class="content"  id="videoo" ><img src="../../image/shipin.png"><span class="text a">Post - Video</span></div>
    <!-- onclick="openvideo()" -->
	  <div class="content"  id="textt" style="visibility: hidden;"><img src="../../image/wenzi.png"><span class="text b">Post - Text</span></div>
	  <div class="content" id="imgg"><img src="../../image/duotu.png"><span class="text c">Post - Photo</span></div>
	  <div class="content" id="cann"><img src="../../image/xiangji.png"><span class="text d">Post - Camera</span></div>
	</div>
</body>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">
  apiready=function () {
    api.addEventListener({
        name: 'reloadnav'
    }, function(ret, err) {
      console.log('刷新NAV');
      window.location.reload();
    });


    if($api.getStorage("language")=="zho"){
      $api.text($api.dom(".a"),"發 帖 - 視 頻") ;
      $api.text($api.dom(".b"),"發 帖 - 文 字") ;
      $api.text($api.dom(".c"),"發 帖 - 相 冊") ;
      $api.text($api.dom(".d"),"發 帖 - 相 機") ;
      // document.getElementsByClassName("lunbo")[0].src="../../image/bozhu.png";
    }
    var id = $api.getStorage('id');
    var videoo = $api.dom("#videoo");
    var textt = $api.dom("#textt");
    var imgg = $api.dom("#imgg");
    var cann = $api.dom("#cann");
    var firsttindata;
    var imgbox = $api.dom("#imgbox");
    var lunbo = document.getElementById('lunbo');
    var topleft = document.getElementById('topleft');
    var topright = document.getElementById('topright');
    var li = lunbo.getElementsByTagName('li');
    var imgWidth = imgbox.offsetWidth;
    var time=null;
    var key=0;

      topright.onclick=function(){
        key++;
        if(key>li.length-1){
          key=li.length-1;
          lunbo.style.left=lunbo.style.left;
        }else{
          animatefn(lunbo,-key*imgWidth);
        }
      }
      topleft.onclick=function(){
        key--;
        if(key<0){
          key=0;
          lunbo.style.left=0+"px";
        }else{
          animatefn(lunbo,-key*imgWidth);
        }
      }
      // 左右滑動切換圖片功能
      imgbox.addEventListener('touchstart',function(event){
        event=event ||window.event;
        var xx=event.touches[0].clientX;
      imgbox.addEventListener('touchend',function(event){
        event=event ||window.event;
        // var y=event.pageY ||scroll().top+event.clientY;
        // if(xx==undefined){
        //   xx=event.pageX ||scroll().left+event.clientX;
        // }
        var x=event.changedTouches[0].clientX;
        // console.log(x);
        // console.log(xx);
        if(x-xx<0){
           key++;
        if(key>li.length-1){
          key=li.length-1;
          lunbo.style.left=lunbo.style.left;
        }else{
          animatefn(lunbo,-key*imgWidth);
        }
        xx=undefined;
      }else if(x-xx>10){
        key--;
        if(key<0){
          key=0;
          lunbo.style.left=0+"px";
        }else{
          animatefn(lunbo,-key*imgWidth);
        }
        xx=undefined;
      }
      });
      })
      // 加載公告
      var announcement_img_url=[],
          announcement_link=[],
          announcement_type=[],
          announcement_content=[],
          announcement_title=[],
          temp="";
      api.ajax({
          url: 'http://api.baopinghui.com/app_AnnouncementController/findAllAnnouncement',
          method: 'post'
      }, function(ret, err) {
          if (ret) {
              var announcement_length=ret.data.length;
              for(var i=0;i<announcement_length;i++){
                announcement_img_url.push(ret.data[i].img_url);
                announcement_link.push(ret.data[i].link);
                announcement_type.push(ret.data[i].type);
                announcement_content.push(ret.data[i].content);
                announcement_title.push(ret.data[i].title);
              }
              if(announcement_length>5){
                announcement_length=5;
              }else{
                announcement_length=announcement_length;
              }
              if($api.getStorage('language')=="zho"){
                for(var i=0;i<announcement_length;i++){
                  if(announcement_type[i] =="user"){
                    temp +='<li><img class="lunbo" src="http://bin.baopinghui.com/'+announcement_img_url[i]+'" onclick=\'openhome("'+announcement_link[i]+'")\'><div class="imgcontent">'+announcement_content[i]+'</div></li>';
                  }else{
                    temp +='<li><img class="lunbo" src="http://bin.baopinghui.com/'+announcement_img_url[i]+'" onclick=\'openweb("'+announcement_link[i]+'")\'><div class="imgcontent">'+announcement_content[i]+'</div></li>';
                  }
                };
              }else{
                for(var i=0;i<announcement_length;i++){
                  if(announcement_type[i] =="user"){
                    temp +='<li><img class="lunbo" src="http://bin.baopinghui.com/'+announcement_img_url[i]+'" onclick=\'openhome("'+announcement_link[i]+'")\'><div class="imgcontent">'+announcement_title[i]+'</div></li>';
                  }else{
                    temp +='<li><img class="lunbo" src="http://bin.baopinghui.com/'+announcement_img_url[i]+'" onclick=\'openweb("'+announcement_link[i]+'")\'><div class="imgcontent">'+announcement_title[i]+'</div></li>';
                  }
                };
              }

              temp +='<li><div class="imgend" onclick="openlist()">V I E W   A L L</div></li>';
              $api.append($api.dom('#lunbo'), temp);
              $api.css($api.dom('.loading'), 'display:none;');
          } else {
              console.log(JSON.stringify(err));
          }
      });



    $.ajax({
      // async: false,
      url: 'http://api.baopinghui.com/app_dynamicCover/CheckFirstTin',
      type: 'post',
      dataType: 'json',
      data: {
        uiId:id
      },
    })
    .done(function(ret) {
      if (ret) {
              firsttindata = ret["data"];
            };
            return;
    });
    // setTimeout(alert(firsttindata),500);
    // for(var i=0;i<=4;i++){
      videoo.onclick=function(){
        if(api.systemType=="ios"){
          if(firsttindata == 0){
            // i=0;
            api.openFrame({
                      name: 'out',
                      url: 'widget://html/nav/out.html',
                      rect: {
                          x: 0,
                          y: 0,
                          w: 'auto',
                          h: 'auto'
                      },
                      pageParam: {
                          firsttin:1,
                          type:1,
                          i:0
                      }
              });
          }else{
            openvideo();
          };


        }else{
    //安卓申请访问资源的权限
          api.requestPermission({
              list: ["storage"],
          }, function(ret, err) {
                if(ret.list[0].granted){
                  if(firsttindata == 0){
                    // i=0;
                    api.openFrame({
                              name: 'out',
                              url: 'widget://html/nav/out.html',
                              rect: {
                                  x: 0,
                                  y: 0,
                                  w: 'auto',
                                  h: 'auto'
                              },
                              pageParam: {
                                  firsttin:1,
                                  type:1,
                                  i:0
                              }
                      });
                  }else{
                    openvideo();
                  };
                }
          });

        }


      };
      textt.onclick=function(){
        if(firsttindata == 0){
          // i=1;
          api.openFrame({
                    name: 'out',
                    url: 'widget://html/nav/out.html',
                    rect: {
                        x: 0,
                        y: 0,
                        w: 'auto',
                        h: 'auto'
                    },
                    pageParam: {
                        firsttin:1,
                        type:'text',
                        i:1
                    }
            });
        }else{
          openPost('text');
        }
      };
      imgg.onclick=function(){
        if(api.systemType=="ios"){
          if(firsttindata == 0){
            // i=2;
            api.openFrame({
                      name: 'out',
                      url: 'widget://html/nav/out.html',
                      rect: {
                          x: 0,
                          y: 0,
                          w: 'auto',
                          h: 'auto'
                      },
                      pageParam: {
                          firsttin:1,
                          type:'Topimg',
                          i:2
                      }
              });
          }else{
            openPost('Topimg');
          }

        }else{
          //安卓申请获取资源的权限
          api.requestPermission({
              list: ["storage"],
          }, function(ret, err) {
                if(ret.list[0].granted){
                    if(firsttindata == 0){
                      // i=2;
                      api.openFrame({
                                name: 'out',
                                url: 'widget://html/nav/out.html',
                                rect: {
                                    x: 0,
                                    y: 0,
                                    w: 'auto',
                                    h: 'auto'
                                },
                                pageParam: {
                                    firsttin:1,
                                    type:'Topimg',
                                    i:2
                                }
                        });
                    }else{
                      openPost('Topimg');
                    }

                }


          });

        }



      };
      cann.onclick=function(){
        if(api.systemType=="ios"){
          if (firsttindata == 0) {
            // i=3;
            api.openFrame({
                      name: 'out',
                      url: 'widget://html/nav/out.html',
                      rect: {
                          x: 0,
                          y: 0,
                          w: 'auto',
                          h: 'auto'
                      },
                      pageParam: {
                          firsttin:1,
                          type:1,
                          i:3
                      }
              });
          }else{
            opencer();
          }

        }else{
          //安卓申请打开相机权限
          api.requestPermission({
              list: ["camera","storage"],
          }, function(ret, err) {
                if(ret.list[0].granted){
                  if (firsttindata == 0) {
                    // i=3;
                    api.openFrame({
                              name: 'out',
                              url: 'widget://html/nav/out.html',
                              rect: {
                                  x: 0,
                                  y: 0,
                                  w: 'auto',
                                  h: 'auto'
                              },
                              pageParam: {
                                  firsttin:1,
                                  type:1,
                                  i:3
                              }
                      });
                  }else{
                    opencer();
                  }

                }


          });

        }


      };
      api.addEventListener({
          name: 'openvideoo'
      }, function(ret, err) {
          openvideo();
      });
      api.addEventListener({
          name: 'openPostt'
      }, function(ret, err) {
        // alert(ret.value.type);
          openPost(ret.value.type);
      });
     };
    // };

  //跳转发帖子
  function openPost(type){
    api.openWin({
      name: 'post',
      url: 'widget://html/details/post.html',////chat/chat2.html
        reload: true,
        vScrollBarEnabled: false,
        slidBackEnabled: false,
      animation: {
        type: "fade", //动画类型（详见动画类型常量）
        subType: "fade", //动画子类型（详见动画子类型常量）
        duration: 500 //动画过渡时间，默认300毫秒
      },
      pageParam: {
        type:type
      }
    });
  };

//     setTimeout(function(){//加延迟是防止提前关闭页面而导致无法跳转页面
// //				关闭导航
//       api.sendEvent({
//           name: 'colse_nav'
//       });
// //				关闭页面
//       api.closeFrame({});
//     },1000)

  //打开相
  function opencer(){

    api.getPicture({
      sourceType: 'camera',
      encodingType: 'jpg',
      mediaValue: 'pic',
      destinationType: 'url',
      allowEdit: true,
      preview: true, //描述：（可选项）是否选择图片后进行预览，只支持iOS。
      quality: 50,
      saveToPhotoAlbum: true
    }, function(ret, err) {
      if(ret) {
        //								alert(JSON.stringify(ret.data));
        //uploadPic(ret.data);
        if(ret.data!=""){
          api.openWin({
            name: 'post',
            url: 'widget://html/details/post.html',
              reload: true,
              vScrollBarEnabled: false,
              slidBackEnabled: false,
            animation: {
              type: "fade", //动画类型（详见动画类型常量）
              subType: "fade", //动画子类型（详见动画子类型常量）
              duration: 500 //动画过渡时间，默认300毫秒
            },
            pageParam: {
              type:'Topimg'
            }
          });
        }
      } else {
        alert(JSON.stringify(err));
      }
    });
  }


  //上传视频
  function openvideo(){

    api.openWin({
      name: 'post',
      url: 'widget://html/details/post.html',
        reload: true,
        vScrollBarEnabled: false,
        slidBackEnabled: false,
      animation: {
        type: "fade", //动画类型（详见动画类型常量）
        subType: "fade", //动画子类型（详见动画子类型常量）
        duration: 500 //动画过渡时间，默认300毫秒
      },
      pageParam: {
        type:'Video'
      }
    });

  }

  function animatefn(ele,target){
      clearInterval(ele.time);
      var speed=ele.offsetLeft<target?10:-10;
      ele.time=setInterval(function(){
        var val=ele.offsetLeft-target;
        ele.style.left=ele.offsetLeft+speed+"px";
        if(Math.abs(val)<=10){
          ele.style.left=ele.offsetLeft+"px";
          clearInterval(ele.time);
        }
      },5)
  }
  function openlist(){
    api.openWin({
        name: 'announcement_list',
        url: 'widget://html/announcement/announcement_list.html',
        pageParam: {
            name: 'value'
        }
    });
  }
  function scroll(){
      if(window.pageYOffset!==undefined){
        return{
          top:document.body.scrollTop ||document.documentElement.scrollTop ||window.pageYOffset,
          left:document.body.scrollLeft ||document.documentElement.scrollLeft ||window.pageXOffset
        }
      }
    }
  // 點擊公告打開網頁
  function openweb(url){
    var urll=url;
    if($api.getStorage('language')=='zho'){
      urll=url.split(",")[0];
    }else{
      urll=url.split(",")[1];
    }
    api.openWin({
        name: 'announcement_web',
        url: 'widget://html/announcement/announcement_web.html',
        pageParam: {
            url: urll
        }
    });
    // window.location.href="http://"+url;
  }
  function openhome(id){
    // alert(2);
    api.openWin({
          name: 'home1/'+id,
          url: "widget://html/home/home1.html",
          reload: true,//页面打开过时重新打开执行刷新操作
          vScrollBarEnabled: false,
          slidBackEnabled: false,
          pageParam:{
          otherId: id//其他用户的ID
        }
    });
  }
</script>
</html>

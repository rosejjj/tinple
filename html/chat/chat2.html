<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<style type="text/css">
		* {
			/*border:0px solid blue!important;*/
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			-webkit-user-select: auto;
		}

		/*li{
			border: 0px solid red!important;
		}*/

		header {
			width: 100%;
			height: 18.7vw;
			padding:15px 2.66vw;
			display: -webkit-flex;
			display: flex;
			-webkit-justify-content: space-between;
			justify-content: space-between;
			position: relative;
			z-index: 4;
			background: #ffffff;
			/*box-shadow: 0 0 10px #36A5B2;linear-gradient(to right, #d9afd9 0%, #97d9e1 100%)*/
			/*margin-bottom:3px;*/
			z-index: 100;
			box-shadow: 0px 0px 2px .9px #efefef;
		}
		body,html{
			background: white;

		}
		.back {
			width: 30px;
			height: 30px;
			margin-top: 3.3vw;
			background: url(../../image/back.png)no-repeat center center;
			background-size: cover;
		}

		.info {
			height: 100%;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.info .nickname {
			position: relative;
			top: 4px;
			width:50vw;
			height: 100%;
			line-height:14vw;
			color: #101010;
			font-size: 4.8vw;
			font-weight: bold;
			text-align: center;
			text-shadow: 0 0 1px 0 #36A5B2;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				/*background: red;*/
		}

		.more {
			width: 8.3333vw;
			height: 8.3333vw;
			margin-top: 3.16666vw;
			background: url(../../image/more.png) no-repeat center center;
			background-size: cover;
		}

		.main {
			padding-top:0;
			/*height: 145vw;*/
			height: 83vh;
			padding-bottom: 7vw;
			overflow-y: scroll;
			-webkit-overflow-scrolling: touch;
			position: relative;
			z-index: 4;
		}

		.message-date {
			width: 100%;
			padding: 0 5.5555vw;
			background: white;
		}

		.tips {
			display: inline-block;
			position: relative;
			z-index: 4;
			/*margin-left: 25%;*/
			left: 50%;
			transform: translateX(-50%);
			padding: 0vw 3.7777vw;
			color:white;
			font-weight: bold;
			font-size:11px;
			text-align: center;
			background-color: #d5d5d5;
			border-radius: 10px;
			height: 25px;
			line-height: 25px;
		}
		/*.tips p{
			display: inline-block;
			padding: 2.7777vw 1.7777vw;

			line-height: 25px;
			background: black!important;
			height: 25px;
		}*/


		.message-date .message-wrap {
			display: flex;
			flex-direction: column;
			/*background: white;*/
		}

		.message-date .message-wrap::after {
			content: '';
			display: block;
			clear: both;
		}

		.message-date .message {
			max-width: 70.8333vw;
			color: #fff;
			padding: 8px 15px;
			border-radius: 5.555vw;
			font-weight: bold;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-flow: row wrap;
			text-shadow: 0 0 1px 0 #36A5B2;
			position: relative;
			word-break: break-all;
			/*box-shadow: 0 1px 2px rgba(0, 0, 0, 0.18), 0 2px 2px rgba(0, 0, 0, 0.25);*/
		}

		.message-date .message-left {
			font-size: 12px;
			background-color: #efefef;
			color: #484848;
			align-self: flex-start;
			/*box-shadow: 0px 0px 0px 0px rgba(54, 165, 178, .4);*/
			margin-top: 5.55vw;
			border-top-left-radius: 0 !important;
			font-weight: normal;
		}

		.message-date .message-right {
			font-size: 12px;
			/*background: linear-gradient(to right, #d9afd9 0%, #97d9e1 100%);*/
			background: #484848;
			/*box-shadow: 0px 0px 0px 0px rgba(54, 165, 178, 1);*/
			align-self: flex-end;
			margin-top: 5.55vw;
			border-top-right-radius: 0;
			font-weight: normal;
		}

		.message-date .msg_img {
			max-width: 55.5555vw;
			max-height: 40vw;
			display: block;
			border-radius: 8px;
			object-fit: cover;
			/*border: 5px solid blue;*/
		}
		.message-date .msg_img2 {
			width: 8.33vw;
			height: 8.33vw;
			position: absolute;
			bottom: 2vw;
			right: 2vw;
			opacity: .6;
		}

		.send {
			position: absolute;
			left: -5.77vw;
			bottom: 0;
			width: 15px;
			height: 15px;

			outline: none;
			margin: 0;
			padding: 0;
		}

		.loading {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 5;
		}

		.more-list {
			width: 100%;
			height: 100vh;
			position: fixed;
			top: 0;
			left: 0;
			background-color: rgba(34, 34, 34, .7);
			z-index: 10;
		}

		.list-content {
			width: 94.4vw;
			text-align: center;
			position: absolute;
			left: 50%;
			bottom: 6.93vw;
			transform: translateX(-50%);
		}

		.list-content .list-title {
			width: 100%;
			height: 9.6vw;
			line-height: 9.6vw;
			background:#FFF;
			color: #8F8E94;
			font-size: 3.46vw;
			border-bottom: 1px solid #999;
			border-top-left-radius: 13px;
			border-top-right-radius: 13px;
		}

		.list-content .btn {
			width: 100%;
			height: 15.2vw;
			line-height: 15.2vw;
			background:#FFF;
			color: #0076FF;
			font-size: 5.33vw;
			border-bottom: 1px solid #999;
		}

		.list-content .cancel {
			width: 100%;
			height: 15.2vw;
			line-height: 15.2vw;
			background: white;
			border-radius: 13px;
			margin-top: 2.13vw;
			color: #0076FF;
			font-size: 5.33vw;
			border: 1px solid #9EA6B7;
		}

		.translated {
			max-width: 70.8333vw;
			color: #aaa;
			padding: 2.77vw 5.55vw 0 5.55vw;
			font-size: 12px;
			/*font-weight: bold;*/
			text-shadow: 0 0 1px 0 #36A5B2;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-flow: row wrap;
			position: relative;
			word-break: break-all;
		}

		.translated-left {
			align-self: flex-start;
		}

		.translated-right {
			align-self: flex-end;
		}
		.bin1{
			display: none;
			position: fixed;
			top: 40%;
			transform: translateY(-50%);
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0,0,0,.6);
			/*opacity: 0.6;*/
			width: 200px;
			height: 150px;
			z-index: 9999999999999;
			background-image: url('../../icon/luzhi.gif');
			background-size: cover;
			background-position: center;
			border-radius: 20px;
		}
		.abin1{
				display: none;
				width: 50px;
				height: 20px;
				/*text-align: center;*/
				position: relative;
		}

		.abin3{
				display: block;
				width: 40px;
				 height: 20px;
				/*text-align: center;*/
				position: relative;

				/*vertical-align: bottom;*/
		}
	.binimg{
			float: right;
			width: 20px;
			height:20px;
			margin: -0px -10px -10px -10px;
		}
		.binimg_left{
				float: left;;
				width: 20px;
				height:20px;
				margin: 0px -10px -10px -10px;
			}
			.send1 {
				position: absolute;
				top: 2.66vw;
				left: 5vw;
				font-size: 12px;
				color: white;
				width: 40px;
				height: 30px;
				/*margin-right: 100px;*/
				margin-left: -15px;
				/*font-style:italic;*/
				/*margin-top: 3px;*/
				text-align:center;
			}
			.send2{
				position: absolute;
				top:2.6vw;
				left: -20vw;
				/*margin-left: 210px;*/
			/*float: right;*/
			/*font-style:italic;*/
				font-size: 12px;
				color: black;
				width: 30px;
				height: 30px;
				text-align:center;
			}

		[v-cloak] {
			display: none !important;
		}
		.send_time{
	display: inline-block;
	position: relative;
	z-index: 4;
	left: 50%;
	transform: translateX(-50%);
	padding: 0vw 3.7777vw;
	color:#aaa;
	/*font-weight: bold;*/
	font-size:10px;
	text-align: center;
	/*background-color:white;*/
	border-radius: 10px;
	/*height: 25px;*/
	line-height: 25px;
}
#shareMessage,#shareMessage2{
	position: relative;
	display: inline-block;
	height: 70px;
	width: 210px;
	border-radius: 10px;
}
.sharePic,.sharePic2{
	position: absolute;
	top:10px;
	/*bottom:10px;*/
	right:10px;
	height: 50px;
	width: 50px;
	border-radius: 10px;
	background: no-repeat center center;
	background-size: cover;
	object-fit: cover;
}
.sharePic{
	border-top-right-radius: 0;
}
.sharePic2{
	border-top-left-radius: 0;
}
.title{
	/*display: inline-block;*/
	position: absolute;
	top:10px;
	left:10px;
	/*margin-left: -5px;
	margin-top: 2px;*/
	max-height: 40px;
	width: 105px;
	font-size: 10px;
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	/*white-space: nowrap;*/
	overflow: hidden;
	text-overflow: ellipsis;
}
.title2{
	position: absolute;
	top:10px;
	left:10px;
	/*margin-left: -5px;
	margin-top: 2px;*/
	/*max-height: 40px;*/
	height: 50px;
	width: 105px;
	font-size: 10px;
	line-height: 13px;
	/*display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;*/
	/*white-space: nowrap;*/
	overflow: hidden;
	/*text-overflow: ellipsis;*/
}
.content{
	position: absolute;
	bottom:10px;
	left:10px;
	/*margin-top:5px;*/
	font-size: 10px;
	height: 15px;
	width: 130px;
	color:#aaa;
	/*font-weight: normal;*/
}
.box{
	height: 50px;
}
		/*li {
	border: solid 0px red !important;
	border-bottom-width: 0px !important;
}*/
	.matching{
		width: 88.9%;
		height: 170px;
		background: #efefef;
		margin: -10px auto 20px;
		border-radius: 10px;
		/*display: none;*/
	}
	.box{
		position: relative;
		top: 20px;
		width: 88%;
		background: #efefef;
		height: 50px;
		margin: 0 auto;
		text-align: center;
	}
	.avatar{
		position:relative;
		display:inline-block;
		float:left;
		width:13.33vw;
		height:13.33vw;
		background: no-repeat center center;
		background-size: cover;
		border-radius: 25px;
	}
	.progress{
		display: inline-block;
		/*width: 56%;*/
		width:160px;
		height: 8px;
		margin: 20px auto;
		border-radius: 25px;
		background: white;
	}
	.progressBar{
		height: 8px;
		/*width:20%;*/
		background: #F381A3;
		border-radius: 25px;
	}
	.percentage{
		position: relative;
		bottom: 3px;
		font-size: 12px;
		color: #F381A3;
		font-weight: bold;
	}
	.pipeidu{
		margin-top: 3px;
		font-size: 12px;
		color: #F381A3;
		font-weight: bold;
	}
	.circle_box .circle{
		border-radius: 2px;
		width: 8px;
		height: 8px;
		background: #81B2F3;
		margin-top: 8px;
	}
	.circle_box{
		margin-top: 38px;
		margin-left: 23px;
	}
	.circle2{
		color: #AAA;
		font-size: 12px;
		margin-left: 8px;
		font-weight: bold;
	}
	.video{
		position: absolute;
		right: 20px;
		top: 20px;
		height: 30px;
		width: 30px;
		z-index: 999;
	}
	.ma{
		font-size: 12px;
		position: relative;
		top: 1px;
	}
	.redBox{
		position: fixed;
		right: 50%;
		bottom: 70px;
		margin-right:-25px;
		background-color: #F381A3;
		height: 25px;
		line-height: 23px;
		width: 50px;
		border-radius: 15px;
		padding: 0.5vw 1.9vw;
		color:white;
		z-index: 999;
		text-align: center;
		font-size: 12px;
		font-weight: bold;
		display: none;
		/*-webkit-transform: translateY(0);*/
		/*-webkit-overflow-scroll:touch;*/
	}
	.jiantou{
		transform:rotate(90deg);
		position: relative;
		bottom:0.5vw;
	}
	.sanjiaoxing{
		position: absolute;
		left:20px;
		bottom:-6.666px;
		height: 6.666px;
		width: 10px;
	}
	.tips1 {
		/*top:-8px;*/
		display: inline-block;
		left: 50%;
		transform: translateX(-50%);
		position: relative;
		z-index: 4;
		/*padding: 0vw 3.7777vw;*/
		/*margin-bottom: 10px;*/
		color: white;
		font-weight: bold;
		font-size: 11px;
		text-align: center;
		/*background-color: #d5d5d5;*/
		border-radius: 10px;
		height:30px;
		line-height: 25px;
		/*margin-bottom: 8px;*/

	}
	.cos{
		position: absolute;
		top: 10px;
		right: 10px;
		height: 50px;
		width: 50px;
		border-radius: 50%;
		background: no-repeat center center;
		background-size: cover;
		object-fit: cover;
		background-color: #efefef;
	}
	.role{
		position: fixed;
		font-size: 12px;
		/*height: 10vh;*/
		width: 100%;
		background: rgba(239, 239,239,1);
		font-weight: bold;
		/*text-align: center;*/
		display: none;
		z-index: 99999;
	}
	.role p{
		margin-left: 15px;
		padding: 2vh 0;
		line-height: 4vh;
	}
	.cosplay{
		position: relative;
		display: inline-block;
		width: 88.9%;
		height: 90px;
		background: rgba(239,239,239,1);
		margin: -10px auto 20px;
		border-radius: 0 0 10px 10px;
		/*border-top-left-radius: 0;*/
	}
	.avatar1{
		display: block;
		float: left;
		height: 60px;
		width: 60px;
		border-radius: 50%;
		margin-top: 15px;
		margin-left: 20px;
		background: no-repeat center center white;
		background-size: cover;
		object-fit: cover;
	}
	.avatar2{
		height: 62px;
		width: 62px;
		border: 2px solid #efefef;
		margin-left: -18px;
		/*margin-top: 20px;*/
	}
	.playing{
		position: absolute;
		top: 15px;
		left: 135px;
		font-size: 12px;
		line-height: 21px;
		font-weight: bold;
	}
	.oneW{
		color: rgba(0, 0, 0, 0.5);
	}
		</style>
	</head>

	<body>
		<div class="bin1">
		</div>
		<div id="chat" v-cloak>

			<header id="head" @touchstart="closeEmo()">
				<span class="back" @click="closed"></span>
				<div class="info">
					<span class="nickname">{{nickname}}</span>
				</div>
				<span class="more"  style="opacity:1;"  @click='clcikHeader'></span>
				<!-- @click='moreList("open")' -->
			</header>
			<div class="role" @click='rolePage()'><p>There are still two unfinished tasks today.<br/><span style="color:rgba(0,0,0,0.5);">Intimacy indexï¼š12%</span></p></div>
			<div class="loading" v-show="isLoading">
				<img src="../../icon/messages/loading.gif" style="width: 13.33vw;height: 13.33vw;" />
			</div>
			<!-- æœªè¯»æ¶ˆæ¯çº¢ç‚¹ v-if='redBoxVal>0'-->
			<div class="redBox" @click='zhiding()'><img class="sanjiaoxing" src="../../icon/sanjiaoxing.png">NEW</div>

			<div class="main" id="main" @touchstart="closeEmo()">
				<div class="matching" v-if="matching">
					<div class="box">
							<span :style="getPic(avatar)" class="avatar" style="float:left;" @click="openHome(targetId)"></span>
							<div class="progress">
								<div style="margin-top:-19px;">
									<span class="percentage">{{match}}%</span>
									<div class="progressBar"></div>
									<span class="pipeidu">Matching Degree</span>
								</div>
							</div>
							<span :style="getPic(avatar_mine)" class="avatar" style="float:right;"></span>
					</div>
					<div class="circle_box">
							<span class="circle"></span><span class="circle2">{{sex}} {{adjective}}</span><br />
							<span class="circle"></span><span class="circle2">{{sex}} <span class="circle3">is from</span> <span class="spacing">{{area}}</span></span><br />
							<span class="circle"></span><span class="circle2">{{sex}} <span class="circle4">is Destiny number</span> {{fate}}<span class="circle5">, Cancer</span> <span class="spacing">{{constellation2}}</span></span><br />
					</div>
				</div>
				<div class="message-date">
					<div class="dingwei" style="margin-top:10px;margin-bottom:0;display:none">
						<!--<span>Chat Content Will Be Deleted After 7 Days</span>-->
						<img class="tips1" src="../../icon/messages/loading.gif"/>

					</div>
					<ul class="message-wrap" v-for="(msg,index) in messageArr">
						<!--  -->
					<!-- æ—¶é—´æ˜¾ç¤º v-show="showMessagetime(msg.create_time,index)!=''&&msg.msg_body.extras.type!=matchs&&msg.msg_body.extras.type!='txt2'"-->
					<li style="margin-top:10px;" v-show="showMessagetime(msg.create_time,index)!=''&&msg.msg_body.extras.type!=matchs&&msg.msg_body.extras.type!='txt2'&&msg.msg_body.extras.hidden!='yes'"><div class="send_time" v-if="msg.from_id==targetId||msg.from_id==ownId" style="text-align:center;" v-html='showMessagetime(msg.create_time,index)'></div></li>
					 <!-- æ¥å—è§’è‰²æ‰®æ¼”åå‘çš„ä¸€æ¡æç¤º -->
					<li class="cosplay" style="width:100%;margin-top:11px;margin-bottom:-4px;" v-if="msg.msg_body.extras.type=='role'">
						<span class="avatar1" :style="getPic(msg.msg_body.extras.ownHead)"></span>
						<span class="avatar1 avatar2" :style="getPic(msg.msg_body.extras.data.avatar_url)"></span>
						<p class="playing">You and <span v-html="msg.msg_body.extras.data.nickname"></span> have started role<br/>playing: couple.<br/><span class="oneW">The time is one week.</span></p>
					</li>
						<!-- åˆ«äººçœ‹åˆ°çš„åŒ¹é… msg.from_id==targetId-->
					<li class="matching" style="width:100%;margin-top:11px;margin-bottom:-4px;" v-if="msg.from_id==targetId&&msg.msg_body.extras.type==matchs">
						<div class="box">
								<span :style="getPic(avatar)" class="avatar" style="float:left;" @click="openHome(targetId)"></span>
								<div class="progress">
									<div style="margin-top:-19px;">
										<span class="percentage">{{msg.msg_body.extras.match}}%</span>
										<div class="progressBar" :style="{width:(msg.msg_body.extras.match)+'%'}"></div>
										<span class="pipeidu">Matching Degree</span>
									</div>
								</div>
									<span :style="getPic(avatar_mine)" class="avatar" style="float:right;"></span>
						</div>
						<div class="circle_box">
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex_me)}}{{adjJudge(msg.msg_body.extras.adjective_me)}}</span><br />
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex_me)}} <span class="circle3">is from</span> <span class="spacing">{{translate(msg.msg_body.extras.area_me,1,index)}}</span></span><br />
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex_me)}} <span class="circle4">is Destiny number</span> {{msg.msg_body.extras.fate_me}}<span class="circle5">, Cancer</span> <span class="spacing">{{translate(msg.msg_body.extras.constellation1,2,index)}}</span></span><br />
						</div>
					</li>
						<!-- è‡ªå·±çœ‹åˆ°çš„åŒ¹é… -->
					<li class="matching" style="width:100%;margin-top:11px;margin-bottom:-4px;" v-if="msg.from_id==ownId&&msg.msg_body.extras.type==matchs&&!matching">
						<div class="box">
								<span :style="getPic(avatar)" class="avatar" style="float:left;" @click="openHome(targetId)"></span>
								<div class="progress">
									<div style="margin-top:-19px;">
										<span class="percentage">{{msg.msg_body.extras.match}}%</span>
										<div class="progressBar" :style="{width:(msg.msg_body.extras.match)+'%'}"></div>
										<span class="pipeidu">Matching Degree</span>
									</div>
								</div>
								<span :style="getPic(avatar_mine)" class="avatar" style="float:right;"></span>
						</div>
						<div class="circle_box">
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex)}}{{adjJudge(msg.msg_body.extras.adjective)}}</span><br />
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex)}}<span class="circle3">is from</span> <span class="spacing">{{translate(msg.msg_body.extras.area,1,index)}}</span></span><br />
								<span class="circle"></span><span class="circle2">{{sexJudge(msg.msg_body.extras.sex)}} <span class="circle4">is Destiny number</span> {{msg.msg_body.extras.fate}}<span class="circle5">, Cancer</span> <span class="spacing">{{translate(msg.msg_body.extras.constellation2,2,index)}}</span></span><br />
						</div>
					</li>
				<!-- æ–‡æœ¬ -->
				<!-- åŒ¹é…åä¿¡æ¯é¢ å€’ -->
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type=='txt2'" style="margin-top:16px;margin-bottom:1px;" @click="translateLang3(index)" class="message message-left" v-html='showMessage(msg)' @touchstart="gtouchstart(event,index,1)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" ></li>
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type=='txt2'&&msg.translated" class="translated translated-left" v-html='showMessage2(msg)'  @click="copy(event,index)"></li>
						<li v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='txt2'" style="margin-top:16px;margin-bottom:1px;" @click="translateLang3(index)" class="message message-left" v-html='showMessage(msg)' @touchstart="gtouchstart(event,index,1)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" ></li>
						<li v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='txt2'&&msg.translated" class="translated translated-left" v-html='showMessage2(msg)'  @click="copy(event,index)"></li>
				 <!-- åˆ«äººå‘çš„æ–‡å­— -->
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='txt'" @click="translateLang3(index)" class="message message-left" v-html='showMessage(msg)' @touchstart="gtouchstart(event,index,1)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="margin-top:10px;"></li>
			 <!-- åˆ«äººå‘çš„ è¯­éŸ³ ä»¥å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='voice'&&msg.msg_body.extras.url==null"  class="message message-left"  @click="xiazai(msg.msg_body.text,index,msg.msg_body.extras.duration)"  @touchstart="gtouchstart(event,index,2)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="margin-top:10px;padding:6px 15px !important;">
															<p class="send2"  v-html='msg.msg_body.extras.duration+"\""' :style="{marginLeft:(msg.msg_body.extras.duration>=10)?(205+'px'):((msg.msg_body.extras.duration)*10+95+'px')}"></p><!--: -->
																<div class="abin1" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
																	<img class="binimg_left" src='../../icon/icon-chat-voice-GIF-black.gif'></img>
																</div>
																<div class="abin3" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
															<img class="binimg_left" src='../../icon/icon-chat-voice-black@3x2.png'></img>
																</div>


						</li>
			<!-- åˆ«äººå‘çš„ è¯­éŸ³ å½“å‰å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='voice'&&msg.msg_body.extras.url!=null"  class="message message-left"  @click="xiazai(msg.msg_body.extras.url,index,msg.msg_body.extras.duration)"  @touchstart="gtouchstart(event,index,2)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="padding:6px 15px !important;">
															<p class="send2"  v-html='msg.msg_body.extras.duration+"\""' :style="{marginLeft:(msg.msg_body.extras.duration>=10)?(205+'px'):((msg.msg_body.extras.duration)*10+95+'px')}"></p>
																<div class="abin1" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
																	<img class="binimg_left" src='../../icon/icon-chat-voice-GIF-black.gif'></img>
																</div>
																<div class="abin3" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
															<img class="binimg_left" src='../../icon/icon-chat-voice-black@3x2.png'></img>
																</div>


						</li>
						<!-- åˆ«äººå‘çš„ åˆ†äº«é“¾æ¥ -->
						<li @click="openDetail(msg.msg_body.extras.postId,msg.msg_body.extras.otherId)" v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='share'" id="shareMessage" class="message message-left" style="margin-top:10px;">
								<img class="video" src="../../icon/Video.png" v-if="msg.msg_body.extras.post_type=='Video'">
								<!-- <img class="sharePic2" :src=msg.msg_body.extras.img></img> -->
								<img class="sharePic2" :src="msg.msg_body.extras.img" onerror="javascript:this.src='http://bin.baopinghui.com'">
									<p class="title">{{msg.msg_body.extras.title}}</p>
									<p class="content" style="font-weight:normal"><span class="ma">Â©</span>{{msg.msg_body.extras.postUsername}}</p>
						</li>
					<!-- ç¿»è¯‘ -->
						<li v-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type==txt&&msg.translated" class="translated translated-left" v-html='showMessage2(msg)'  @click="copy(event,index)" ></li>
				 <!--  åˆ«äººå‘çš„ å›¾ç‰‡ ä»¥å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
						<li v-else-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type==img&&msg.msg_body.extras.url==null" class="message message-left" style="padding: 0px;border-radius:8px;margin-top:10px;">
							<img class="msg_img" :src='msg.msg_body.text+"?imageView2/0/w/250/auto-orient"' @click='sacnImage(msg.msg_body.text)' style="border-top-left-radius: 0;" @touchstart="gtouchstart(event,index,3)" @touchmove="gtouchmove()" @touchend="gtouchend(index)"/>
							<!-- <img class="msg_img2" src="../../icon/messages/enlarge.png" /> -->
						</li>
				<!-- åˆ«äººå‘çš„  å›¾ç‰‡ å½“å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼å’ŒåŸç”ŸIOSä¸€æ ·extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
						<li v-else-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type==img&&msg.msg_body.extras.url!=null" class="message message-left" style="padding: 0px;border-radius:8px;margin-top:10px;" >
							<img class="msg_img" :src='msg.msg_body.extras.url+"?imageView2/0/w/250/auto-orient"' @click='sacnImage(msg.msg_body.extras.url)' style="border-top-left-radius: 0;" @touchstart="gtouchstart(event,index,3)" @touchmove="gtouchmove()" @touchend="gtouchend(index)"/>

						</li>
						<!-- è‡ªå·±å‘çš„ç¾¤åˆ†äº« -->
						<li @click="openGroup(msg.msg_body.extras.gid)" v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='shareGroup'" id="shareMessage" class="message message-right" style="margin-top:10px;border-top-right-radius:0;">
								<span class="sharePic" :style="getPic(msg.msg_body.extras.avatar_url)"></span>
									<p class="title">Invite you to join the group and play together~</p>
									<p class="content" style="font-weight:normal;">#{{msg.msg_body.extras.nickname}}</p>
						</li>
						<!-- åˆ«äººå‘çš„ç¾¤åˆ†äº« -->
						<li @click="openGroup(msg.msg_body.extras.gid)" v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='shareGroup'" id="shareMessage" class="message message-left" style="margin-top:10px;border-top-left-radius:0;">
								<span class="sharePic2" :style="getPic(msg.msg_body.extras.avatar_url)"></span>
									<p class="title">Invite you to join the group and play together~</p>
									<p class="content" style="font-weight:normal">#{{msg.msg_body.extras.nickname}}</p>
						</li>
						<!--è‡ªå·±å‘çš„ æ¶ˆæ¯-->

						<!-- è‡ªå·±å‘çš„è§’è‰²æ‰®æ¼” -->
						<li id="shareMessage" @click="openRole(msg.msg_body.extras.data)" class="message message-right" v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='couple'" style="margin-top:10px;border-top-right-radius:0;">
								<span class="cos" :style="getPic(msg.msg_body.extras.data.avatar_url)"></span>
									<p class="title2">Invite you to play a<br/>role-playing gameğŸ¤–<br/><span style="color:#aaa;">One week<br/>Couple</span></p>
						</li>
						<!-- åˆ«äººå‘çš„è§’è‰²æ‰®æ¼” -->
						<li id="shareMessage" @click="openRole(msg.msg_body.extras.data)" class="message message-left" v-if="msg.from_id==targetId&&msg.target_id==ownId&&msg.msg_body.extras.type=='couple'" style="margin-top:10px;">
								<span class="cos" :style="getPic(msg.msg_body.extras.data.avatar_url)"></span>
									<p class="title2">Invite you to play a<br/>role-playing gameğŸ¤–<br/><span style="color:#aaa;">One week<br/>Couple</span></p>
						</li>
						<!--è‡ªå·±å‘çš„åˆ†äº«é“¾æ¥-->
						<li @click="openDetail(msg.msg_body.extras.postId,msg.msg_body.extras.otherId)" v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type==share" id="shareMessage" class="message message-right" style="margin-top:10px;">
								<img class="video" src="../../icon/Video.png" v-if="msg.msg_body.extras.post_type=='Video'">
								<!-- <img class="sharePic"	 :src=msg.msg_body.extras.img></img> -->
								<img class="sharePic" :src="msg.msg_body.extras.img" onerror="javascript:this.src='http://bin.baopinghui.com'">
									<p class="title">{{msg.msg_body.extras.title}}</p>
									<p class="content" style="font-weight:normal;"><span class="ma">Â©</span>{{msg.msg_body.extras.postUsername}}</p>
						</li>
						<!-- è°ƒç”¨æ¯å¤©ç»™4ä¸ªäººå‘é€æ¶ˆæ¯åè‡ªå·±çœ‹åˆ°çš„å†…å®¹ -->
						<li class="sayl" v-if="msg.from_id==ownId&&msg.msg_body.extras.type=='txt3'" style="margin-top:10px;font-size:12px;color:#aaa;text-align:center;letter-spacing:1px;" v-html="commonHabbies(msg.msg_body.extras.hobbies_common)"></li>
						<!-- è°ƒç”¨æ¯å¤©ç»™4ä¸ªäººå‘é€æ¶ˆæ¯ååˆ«äººçœ‹åˆ°çš„å†…å®¹ -->
						<li class="sayl" v-if="msg.from_id==targetId&&msg.target_id==ownId&msg.msg_body.extras.type=='txt3'" style="margin-top:10px;font-size:12px;color:#aaa;text-align:center;letter-spacing:1px;" v-html="commonHabbies(msg.msg_body.extras.hobbies_common)"></li>
					<!-- è‡ªå·±å‘çš„ æ–‡å­— msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='txt -->
							<li v-if="hid(msg)" @click="translateLang3(index)" class="message message-right" v-html='showMessage(msg)' @touchstart="gtouchstart(event,index,1)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="margin-top:10px;"></li>
					<!--  è‡ªå·±å‘çš„è¯­éŸ³ ä»¥å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„- -->
							<li v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='voice'&&msg.msg_body.extras.url==null"  @click="xiazai(msg.msg_body.text,index,msg.msg_body.extras.duration)" class="message message-right"  @touchstart="gtouchstart(event,index,2)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="margin-top:10px;padding:6px 15px !important;">
								<!-- <img class="send" src="../../image/emotion/Expression_1.png" /> -->
								<p class="send1"  v-html='msg.msg_body.extras.duration+"\""'>	</p>
									<img class="send" style="border: none;" :src="(msg.msg_body.extras.fail!='1')?('../../icon/touming.png'):('../../icon/messages/loading.gif')" />
									<!-- <img class="hong" src="../../icon/3.png" /> -->
									<div class="abin1 " :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
									<img class="binimg" src='../../icon/icon-chat-voice-GIF2.gif'></img>
									</div>
									<div class="abin3" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
								<img  class="binimg" src='../../icon/icon-chat-voice-white3x2.png'></img>
									</div>
							</li>
						<!--è‡ªå·±å‘çš„è¯­éŸ³  å½“å‰å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„- -->
						<li v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type=='voice'&&msg.msg_body.extras.url!=null"  @click="xiazai(msg.msg_body.extras.url,index,msg.msg_body.extras.duration)" class="message message-right"  @touchstart="gtouchstart(event,index,2)" @touchmove="gtouchmove()" @touchend="gtouchend(index)" style="margin-top:10px;">

							<p class="send1"  v-html='msg.msg_body.extras.duration+"\""'>	</p>
								<img class="send" style="border: none;" :src="(msg.msg_body.extras.fail!='1')?('../../icon/touming.png'):('../../icon/messages/loading.gif')" />

								<div class="abin1 " :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
								<img class="binimg" src='../../icon/icon-chat-voice-GIF2.gif'></img>
								</div>
								<div class="abin3" :style="{width:(msg.msg_body.extras.duration>=10)?140+'px':(msg.msg_body.extras.duration)*10+30+'px'}">
							<img  class="binimg" src='../../icon/icon-chat-voice-white3x2.png'></img>
								</div>
						</li>

					<!-- ç¿»è¯‘ -->
						<li v-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type==txt&&msg.translated" class="translated translated-right" v-html='showMessage2(msg)'  @click="copy(event,index)"></li>
					<!-- è‡ªå·±å‘çš„ å›¾ç‰‡ ä»¥å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
						<li v-else-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type==img&&msg.msg_body.extras.url==null" class="message message-right" style="padding: 0px;border-radius:8px;margin-top:10px;">
							<img class="msg_img" :src='msg.msg_body.text+"?imageView2/0/w/250/auto-orient"' @click='sacnImage(msg.msg_body.text)' style="border-top-right-radius: 0;" @touchstart="gtouchstart(event,index,3)" @touchmove="gtouchmove()" @touchend="gtouchend(index)"/>
					<img class="send" :src="(msg.msg_body.extras.fail!='1')?('../../icon/messages/send2.png'):('../../icon/messages/loading.gif')" />
						</li>
					<!-- è‡ªå·±å‘çš„ å›¾ç‰‡ å½“å‰ç‰ˆæœ¬çš„å›¾ç‰‡å‘é€æ ¼å¼å’ŒåŸç”ŸIOSä¸€æ ·extrasä¸­æ˜¯æ²¡æœ‰ urlå­—æ®µçš„-->
					<li v-else-if="msg.from_id==ownId&&msg.target_id==targetId&&msg.msg_body.extras.type==img&&msg.msg_body.extras.url!=null" class="message message-right" style="padding: 0px;border-radius:8px;margin-top:10px;">
						<img class="msg_img" :src='msg.msg_body.extras.url+"?imageView2/0/w/250/auto-orient"' @click='sacnImage(msg.msg_body.extras.url)' style="border-top-right-radius: 0;" @touchstart="gtouchstart(event,index,3)" @touchmove="gtouchmove()" @touchend="gtouchend(index)"/>
				<img class="send" :src="(msg.msg_body.extras.fail!='1')?('../../icon/messages/send2.png'):('../../icon/messages/loading.gif')"/>
					</li>
					</ul>
				</div>
			</div>

			<div class="more-list" @click="dispnone()" v-show="moreListShow">
				<ul class="list-content">
					<li class="list-title">Automatic Translation</li>
					<li class="btn" @click='selectLang("zh")'>ç¹ä½“ä¸­æ–‡</li>
					<li class="btn" @click='selectLang("en")'>English</li>
					<li class="btn" @click='selectLang("kor")'>í•œêµ­ì˜</li>
					<li class="btn" @click='selectLang("th")'>à¸ à¸²à¸©à¸²à¹„à¸—à¸¢</li>
					<li class="btn" @click='selectLang("jp")' style="border-bottom-left-radius:13px;border-bottom-right-radius:13px;">
						æ—¥æœ¬èª
					</li>
					<li class="cancel">Cancel</li>
				</ul>

			</div>

		</div>
	</body>
	<script src="../../json/api.json"></script>
	<script src="../../json/router.json"></script>
	<script src="../../json/hobby.json"></script>
	<script src="../../script/vue.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../script/api.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../script/public.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../script/jquery-3.1.0.min.js" type="text/javascript"></script>
	<script src="../../script/md5.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../image/emotion/emotion.json" charset="utf-8"></script>
	<script src="../../image/emotion/emotion2.json" charset="utf-8"></script>
	<script src="../../script/base64.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../script/jmessage-sdk-web.2.6.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../script/nav.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
	var start=new Date();
	var toggle8=true;//ä»£è¡¨è¿˜æœ‰å†å²æ¶ˆæ¯çš„å­˜åœ¨ã€‚
	var toggle10=true; //ç”¨æ¥ä»£è¡¨ä¸‹æ‹‰åŠ è½½å†å²æ¶ˆæ¯æ˜¯å¦è§¦å‘äº‹ä»¶
  var db;
	var	SMessages="singleIM2";//ç”¨å­˜å‚¨å•äººå†å²ä¿¡æ¯
	var failS=[];//ç”¨æ¥å‚¨å­˜æœªç™»å½•æå…‰å‘é€ä¿¡æ¯å¤±è´¥æ˜¯å‘é€å¤±è´¥çš„ä¿¡æ¯æ¶ˆæ¯
	var failtoggle=true; //ç”¨äºåˆ†è¾¨æ˜¯å¦å¼€å¯å¤±è´¥æ¶ˆæ¯é‡å‘åŠŸèƒ½ï¼›
	var toggle6=0;//è®°å½•æ—¶é—´æ˜¾ç¤ºçš„çš„ä¸Šä¸€æ¡å…ˆæ˜¾ç¤ºçš„åæ ‡ï¼›
	var toggle3='';//ä½œä¸ºIOSçš„è¯­éŸ³æ’­æ”¾çŠ¶æ€çš„åˆ¤æ–­ï¼Œå› ä¸ºiosçš„è¯­éŸ³ä¸ªæ¨¡å—ä¸å…¼å®¹
	var chat;
	var invalidvoice=false; //è¯­éŸ³å‘é€æ— æ•ˆ
		var tempMs=(typeof($api.getStorage("tempMs"))!="undefined")?$api.getStorage("tempMs"):[]; //ä¸´æ—¶å†å²æ¶ˆæ¯å‚¨å­˜
	var warn_text = {
	  luzhi: '../../icon/luzhiE.gif',
	  quxiao: '../../icon/quxiaoE.gif',
		tingtong:'receiver',
		yangshengqi:'loudspeaker',
		yuzhuanwen:'Phonetic transcribing',
		short:'The recording time is too short',
		long:'The recording was too long',
	  shuohua: 'HOLD DOWN THE TALK',
		songkai:'Loosen the end',
		send:'send',
	  tishiyu: 'Your operation is a little fast, please slow down and try again',
		text1:'Your network is disconnected( â€¢Ì¥Ì Ë â€¢Ì€à¥‚ )',
 	  text2: 'Pretend not to care',
 	  text3:'âš†_âš†ï¼ŸI can\'t help it',
		text4:'Revocation of failure',
		text5:'Revocation of success',
		text6: 'I am a friend who was found by Tarotï¼Œyou can click on my avatar to view the information and find more interesting things ~ (â—Ë‡âˆ€Ë‡â—)',
		text7: 'I followed the Tarot guide to find youï¼Œyou can click on my avatar to view the information to find out more interesting me ~ (â—Ë‡âˆ€Ë‡â—)'
	};
	adjective_text = {
		oneZero: 'was born in the 2010s',
		zeroFive: 'was born in the 2005s',
		zeroZero: 'was born in the 2000s',
		nineFive: 'was born in the 1995s',
		nineZero: 'was born in the 1990s',
		eightFive: 'was born in the 1985s',
		eightZero: 'was born in the 1980s',
		sevenFive: 'was born in the 1975s',
		sevenZero: 'was born in the 1970s',
		sixFive: 'was born in the 1965s',
		sixZero: 'was born in the 1960s',
		other: 'was born in  Mars'
	}
	if($api.getStorage("language") == "zho") {
		// $('.sayl').html('å¦³å·²ç¶“è·Ÿå¥¹ï¼ˆä»–ï¼‰æ‰“éæ‹›å‘¼äº†');
		$(".title2").html("<p class='title2'>é‚€è¯·ä½ ç©è§’è‰²æ‰®æ¼”æ¸¸æˆğŸ¤–<br/><span style='color:#aaa;'>ä¸€å‘¨<br/>æƒ…ä¾£</span></p>");
		$(".circle3").html("ä¾† è‡ª");
		$(".circle4").html("æ˜¯ å‘½ é‹ æ•¸");
		$(".circle5").html("&nbsp;çš„");
		$(".pipeidu").html("åŒ¹ é… åº¦");
		$('.spacing').css('letter-spacing','2px');
		$('.title').html('é‚€è¯·ä½ è¿›å…¥ç¾¤ç»„ï¼Œä¸€èµ·ç©è€å§~');
	    warn_text = {
	      luzhi: '../../icon/luzhi.gif',
	      quxiao: '../../icon/quxiao.gif',
				tingtong:'å¬ç­’',
				short:'å½•åˆ¶æ—¶é—´å¤ªçŸ­',
				long:'å½•åˆ¶æ—¶é—´è¿‡é•¿',
				yangshengqi:'æ‰¬å£°å™¨',
				yuzhuanwen:'è¯­éŸ³è½¬æ–‡å­—',
	      shuohua: 'æŒ‰ä½ è¯´è¯',
	      songkai: 'æ¾å¼€ ç»“æŸ',
				send:'å‘é€',
	      tishiyu: 'æ‚¨çš„æ“ä½œæœ‰ç‚¹å¿«,éº»çƒ¦æ…¢ç‚¹å†è¯• ä¸€ä¸‹',
				text1:'æ‚¨çš„ç½‘ç»œå·²ç»æ–­å¼€( â€¢Ì¥Ì Ë â€¢Ì€à¥‚ )',
				text2: 'å‡è£…ä¸åœ¨æ„',
				text3:'âš†_âš†ï¼Ÿæˆ‘ä¹Ÿå¸®ä¸äº†',
				text4:'æ’¤é”€å¤±è´¥',
				text5:'æ’¤é”€æˆåŠŸ',
				text6: 'æˆ‘æ˜¯å¡”ç¾…æŒ‡å¼•æ‰¾åˆ°çš„å°å¤¥ä¼´ï¼Œå¯ä»¥é»æ“Šæˆ‘çš„é ­åƒæŸ¥çœ‹è³‡æ–™ç­è§£æ›´æœ‰è¶£çš„æˆ‘å–”~(â—Ë‡âˆ€Ë‡â—)',
				text7: 'æˆ‘è·Ÿéš¨å¡”ç¾…æŒ‡å¼•æ‰¾åˆ°ä½ ï¼Œå¯ä»¥é»æ“Šæˆ‘çš„é ­åƒæŸ¥çœ‹è³‡æ–™ç­è§£æ›´æœ‰è¶£çš„æˆ‘å–”~(â—Ë‡âˆ€Ë‡â—)'
	    };
			adjective_text = {
				oneZero: 'æ˜¯ å¯ æ„› æ´» æ½‘ çš„ 10 å',
				zeroFive: 'æ˜¯ å¤© çœŸ æµª æ¼« çš„ 05 å',
				zeroZero: 'æ˜¯ å¯Œ æœ‰ å‰µ é€  åŠ› çš„ 00 å',
				nineFive: 'æ˜¯ ç†± æƒ… å¹´ è¼• çš„ 95 å',
				nineZero: 'æ˜¯ å€‹ æ€§ é®® æ˜ çš„ 90 å',
				eightFive: 'æ˜¯ ç© æ¥µ å‘ ä¸Š çš„ 85 å',
				eightZero: 'æ˜¯ æ¸´ æœ› è‡ª ç”± çš„ 80 å',
				sevenFive: 'æ˜¯ æ¨‚ è§€ è± é” çš„ 75 å',
				sevenZero: 'æ˜¯ ç¨ ç«‹ ä¸ ç¾ çš„ 70 å',
				sixFive: 'æ˜¯ æˆ ç†Ÿ ç©© é‡ çš„ 65 å',
				sixZero: 'æ˜¯ æ²ˆ è‘— å†· éœ çš„ 60 å',
				other: 'æ˜¯ é‚Š ç·£ äºº å£«'
			}
	  }
	  var hhh =window.screen.height;
    	var www =window.screen.width;
			function openDetail(postId,otherId){//æ‰“å¼€å¸–å­è¯¦æƒ…é¡µ
					api.openWin({
							name: "detail",
							url: "widget://html/details/detail.html",
							reload: true,
							vScrollBarEnabled: false,
							slidBackEnabled: false,
							pageParam:{
									postId: postId,
									otherId: otherId
									// popNum: popNum,
									// tinNum: tinNum,
									// summary: summary,
									// text: isText
							}
					});
			};
		apiready = function() {
			if(api.pageParam['sen']){
				// alert("è¿›æ¥äº†");
				api.sendEvent({
				    name: 'caonima',
				    extra: {
				      		otherId: api.pageParam['uiId']
				    }
				});

			}
			// setTimeout(function(){
			// 	alert(JSON.stringify(chat.messageArr))
			// },2000)
			db=api.require("db");//å¯¼å…¥æ•°æ®åº“æ¨¡å—
		//ç›‘å¬ç¾¤åˆ†äº«æˆåŠŸååŒæ­¥æ›´æ–°chat.messageArr
		 api.addEventListener({
		     name: 'chatMessage'
		 }, function(ret, err){
		     if( ret ){
					 //è·å–ç¾¤åˆ†äº«æˆåŠŸåç¾¤çš„ä¿¡æ¯
					 var msg = ret.value.msg;
		          chat.failSendMessageBody(msg.text,'shareGroup',1,"",msg.extras.gid,msg.extras.avatar_url,msg.extras.nickname);
		     }
		 });
		 api.addEventListener({
		     name: 'role'
		 }, function(ret, err){
		     if( ret ){
		        chat.failSendMessageBody('[è§’è‰²æ‰®æ¼”]',"role",1,'','','','',ret.value.data,ret.value.ownHead);
						$('.role').css('display','block');
		     }
		 });

			//è¯­éŸ³IOSçš„é—´è·å’Œå®‰å“çš„ä¸ä¸€æ ·
			if(api.systemType=='ios'){
				$('.send1').css('top','2.2vw');
				$('.send2').css('top','2.2vw');
				$('.send2').css('left','-18vw');
			}
			var matching=api.pageParam["matching"];//ä¸ºtrueæ—¶è¡¨ç¤ºä»åŒ¹é…é¡µé¢æ‰“å¼€çš„èŠå¤©
			var avatar=api.pageParam["avatar"];
			var otherId=api.pageParam["uiId"];
			$api.setStorage('otherUid', otherId);
			var area=api.pageParam["area"];
			var constellation=api.pageParam["constellation"];
			var noRepeat=api.pageParam['noRepeat'];//åŒ¹é…é¡µé¢ä¼ è¿‡æ¥çš„ï¼Œç­‰äº1æ—¶è¡¨ç¤ºåŒ¹é…åˆ°ä¹‹å‰å·²ç»åŒ¹é…åˆ°çš„ç”¨æˆ·ï¼Œä¸é‡å¤å‘é€åŒ¹é…æ¡
			var emotion;
			var exist;
			setTimeout(function(){
				chat.translate(area,3);
			},1500)

			// setTimeout(function(){
			// 	//è¿›æ¥å°±è·å–è¡¨æƒ…åŒ…
			// 	getEmo();
			// },50)
			// console.log($api.getStorage('avatar'));
			//ä»åŒ¹é…é¡µé¢è¿›æ¥çš„æ—¶å€™æ‰§è¡Œ
			if(matching){
				//åŒ¹é…æˆåŠŸåæŸ¥è¯¢ä¸åŒ¹é…ç”¨æˆ·ä¹‹é—´çš„åŒ¹é…åº¦
				api.ajax({
						url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/getUserMatch',
						method: 'get',
						data: {
								values: {
										uiid1: $api.getStorage('id'),
										uiid2: otherId
								}
						}
				},function(ret, err){
						if (ret) {
							// alert("è¿›æ¥äº†");
							// alert(JSON.stringify(ret));
								chat.constellation2=ret.data.constellation2;
								// var constellation=ret.data.constellation2;
								chat.constellation1=ret.data.constellation1;
								chat.match=ret.data.matching;
								var width=ret.data.matching;
								$(".progressBar").css("width",width+'%');
								chat.translate(chat.constellation2,4);
						}
				});
				api.ajax({
						url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/userinfo',
						method: 'post',
						data: {
								values: {
										uiId: $api.getStorage('id'),
										pageUiId: $api.getStorage('id')
								}
						}
				},function(ret, err){
						if (ret) {
							// alert(JSON.stringify(ret));
							var age_me=parseInt(ret.data.begin_date.substring(0,4));
							// var month= parseInt(ret.data.begin_date.substring(5,7));
							var area_me=ret.data.location;
							var fate_me=ret.data.augury;
							var sex_me=ret.data.sex;
							if(sex_me=='ç”·'||sex_me=='ç”·æ€§'||sex_me=="Male"){
								if($api.getStorage('language')=='zho'){
									chat.sex_me='ä»–';
								}else{
									chat.sex_me='He';
								}
							}else if(sex_me=='å¥³'||sex_me=='å¥³æ€§'||sex_me=="Female"){
								if($api.getStorage('language')=='zho'){
									chat.sex_me='å¥¹';
								}else{
									chat.sex_me='She';
								}
							}
							// alert(age+","+area+","+month);
							chat.age_me=age_me;
							chat.area_me=area_me;
							chat.fate_me=fate_me;
							judge2();
						}
				});
				setTimeout(function(){
					judge();
				},50)
				console.log(noRepeat);
				if(noRepeat!=1){
					setTimeout(function(){
						sendMatch();
					},50)
					setTimeout(function(){
						sendMatchMessage(warn_text.text7);
					},1500)
				}
			}
			// é€‚é…åˆ˜æµ·å±
			if(hhh/www>2){
				$api.css($api.dom('header'), 'margin-top:25px');
				$api.css($api.dom('.main'), 'padding-bottom:13.65vw');
				$('.redBox').css('bottom','104px');
			}
			var sj = getNowFormatDate(); //è·å–å½“å‰æ—¥æœŸ
			var sj2 = getNowFormatDate2(); //è·å–7å¤©å‰çš„æ—¥æœŸ
			var par = Base64.encode('c46c8bc128f41299334ec8e3:269e7aa2881b1a8767f16ce6'); //base64åŠ å¯†
			UIChatBox = api.require('UIChatBox'); //è¾“å…¥æ¡†æ¨¡å—
			imageBrowser = api.require('imageBrowser');
      // photoBrowser = api.require('photoBrowser');ä¸ç”¨äº†
			audioStreamer = api.require('audioStreamer');
			qiniu = api.require('qiniuUpfile'); //ä¸ƒç‰›äº‘æ¨¡å—

			continuegain=false;

			var singlesendtext=api.pageParam['uiId']+'Text';//ç”¨äºå­˜å‚¨æœªå‘é€çš„è‰ç¨¿
			//  bubbleMenu = api.require('bubbleMenu');//æ°”æ³¡æŒ‰é’®èœå•æ¨¡å—
				bin1=$api.dom(".bin1");
				toggle1=-1;
			var iosH = 0;
			var moveLock = true;
			var msgContent = "";
			var time = "";
			var from_id = "";
			var timeOutEvent;
				// alert();
			setTimeout(function(){

				chat.created();

			},100);


//			alert(api.pageParam['avatar']);
//			alert(api.pageParam['nickname']);

			if(api.systemType == 'ios') {
				iosH = 20;
			}
			if($api.getStorage("language")=="zho"){
			 	$api.text($api.dom(".tips"),"èŠ å¤© è¨˜ éŒ„ åƒ… ä¿ ç•™ 7 å¤©") ;
				$api.text($api.dom(".tips2"),"ç›´ æ¥ é» æ“Š èŠ å¤© å†… å®¹ å³ å¯ ç¿» è­¯") ;
			}

//			var header = $api.dom('header');
//			$api.fixStatusBar(header);
			api.setFullScreen({
				fullScreen: false
			});
			api.setStatusBarStyle({
				style: 'dark'
			});
    api.sendEvent({
        name: 'CObject',
        extra: {
            key1: '3',
            key2: api.pageParam['uiId']
        }
    });
				// setInterval('timer1()',3*60*1000);//å®šæ—¶ç¡®å®šæ˜¯å¦è¦ç™»å½•æå…‰
				//
				// api.addEventListener({   //ç›‘å¬æ˜¯ä¸æ˜¯æ»šåˆ°é¡¶éƒ¨æˆ–åº•éƒ¨ åˆ°åº•éƒ¨éšè—çº¢ç‚¹
				// 		name:'scrolltobottom',
				// 		extra:{
				// 				threshold:180           //è®¾ç½®è·ç¦»åº•éƒ¨å¤šå°‘è·ç¦»æ—¶è§¦å‘ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œæ•°å­—ç±»å‹
				// 		}
				// }, function(ret, err){
				// 	var main=$api.dom('.main'); //scrollTopæ»šåŠ¨ç°åœ¨çš„é¡¶éƒ¨ä½ç½®  clientHeightè¿™ä¸ªdomçš„é«˜åº¦ scrollHeightå¯ä»¥æ»šåŠ¨çš„æ€»é•¿åº¦
				// 	if(main.scrollTop+main.clientHeight>main.scrollHeight-160){  //åˆ¤æ–­æ˜¯å¦æ¥è¿‘åº•éƒ¨
				// 		chat.redBoxVal=0; //æœªè¯»æ•°çº¢ç‚¹éšè—
				// 	}
				//
				// });

			// å®‰å“è¿”å›é”®
		api.addEventListener({
				name: 'keyback'
		}, function(ret, err) {
			// //alert("laji");
			chat.closed();
		});
		// å³æ»‘äº‹ä»¶
		api.addEventListener({
					name:'swiperight'
			}, function(ret, err){
				 chat.closed();
			});
			//ç›‘å¬ç½‘ç»œçš„æƒ…å†µæ˜¯å¦æ²¡ç½‘
									api.addEventListener({
								name:'offline'
						}, function(ret, err){
							api.openFrame({
									name: 'duanwang',
									url: '../logon-register/pop.html',

									pageParam: {
											data: warn_text.text1,
											value: warn_text.text2,
											 none: warn_text.text3
									},
									bounces: true,
									bgColor: 'rgba(0,0,0,0)',
									vScrollBarEnabled: true,
									hScrollBarEnabled: true
							});

						});
						//ç›‘å¬æ˜¯å¦æ¥ç½‘äº†
					api.addEventListener({
							name:'online'
					}, function(ret, err){
						//é‡æ–°åˆ·æ–°é¡µé¢
								history.go(0);
							api.closeFrame({
									name: 'duanwang'
							});

					});
       api.addEventListener({
           name: 'onMsgReceive'
       }, function(ret, err){
           if( ret ){
						     var data=ret.value.databody;
								 //å¦‚æœæ˜¯å½“å‰ä¼šè¯å¯¹è±¡çš„æ¶ˆæ¯æ‰ä¿å­˜
								 if(data.messages[0].content.from_id == chat.targetId&&data.messages[0].msg_type=='3'){
									 if(data.messages[0].content.msg_body.extras.type=='img'){
										 if($api.getStorage('language')=='zho'){
											 msgContent="[åœ–ç‰‡]";
										 }else{
											 msgContent="[Picture]";
										 }
									 }else if(data.messages[0].content.msg_body.extras.type=='voice'){
										 if($api.getStorage('language')=='zho'){
											 msgContent="[èªéŸ³]";
										 }else{
											 msgContent="[Voice]";
										 }
									 }else{
											msgContent = data.messages[0].content.msg_body.text;
									 }
									 time = data.messages[0].ctime_ms;
									 from_id = data.from_id;


								 data.messages[0].content.translated = '';
								 // if(chat.translateLang !== "") {
								 // 	translate(data.messages[0].content.msg_body.text, data.messages[0].content);
								 // }
								 var main=$api.dom('.main');
								 var redBoxToggle=true; //ç”¨æ¥åˆ¤æ–­æ˜¯å¦ç½®é¡¶çš„
								if(main.scrollTop+main.clientHeight<main.scrollHeight-180){  //scrollTopæ»šåŠ¨ç°åœ¨çš„é¡¶éƒ¨ä½ç½®  clientHeightè¿™ä¸ªdomçš„é«˜åº¦ scrollHeightå¯ä»¥æ»šåŠ¨çš„æ€»é•¿åº¦
									redBoxToggle=false;
									chat.redBoxVal=chat.redBoxVal+1;
									$('.redBox').css('display','block');
								}else{
									chat.redBoxVal=0;
									$('.redBox').css('display','none');
								}
								 chat.messageArr.push(data.messages[0].content);
								 //è®©æ–°è·å–çš„æ•°æ®å¾€ä¸Šé¡¶
								 if(redBoxToggle){
									 msgToTop();
								 }

								 if(data.messages[0].content.msg_body.extras.type=="img"){
									//  alert("è¿›æ¥ äº†");
									 setTimeout(function() {
										 if(redBoxToggle){
											msgToTop();
										}
									 },1300)
								 }
								}

           }else{
                alert( JSON.stringify( err ) );
           }
       });


			// bubbleMenu2();
			//ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
			function random(length) {
				var str = Math.random().toString(36).substr(2);
				if(str.length >= length) {
					return str.substr(0, length);
				}
				str += random(length - str.length);
				return str;
			}
			//è·å–å½“å‰æ—¶é—´ï¼Œæ ¼å¼YYYY-MM-DD
			function getNowFormatDate() {
				var date = new Date();
				var seperator1 = "-";
				var year = date.getFullYear();
				var month = date.getMonth() + 1;
				var strDate = date.getDate();
				if(month >= 1 && month <= 9) {
					month = "0" + month;
				}
				if(strDate >= 0 && strDate <= 9) {
					strDate = "0" + strDate;
				}
				var currentdate = year + seperator1 + month + seperator1 + strDate;
				return currentdate;
			}
			//æ±‚å‡ºå½“å‰æ—¶é—´çš„7å¤©å‰æ˜¯å‡ å·
			function getNowFormatDate2() {
				var now = new Date();
				var date = new Date(now.getTime() - 6 * 24 * 3600 * 1000);
				var year = date.getFullYear();
				var month = date.getMonth() + 1;
				var day = date.getDate();
				if(month >= 1 && month <= 9) {
					month = "0" + month;
				}
				if(day >= 0 && day <= 9) {
					day = "0" + day;
				}
				//alert(year + '-' + month + '-' + day  + ' ' + hour + ':' + minute + ':' + second);
				return year + '-' + month + '-' + day;
			}

			function  sendMatch(){
						 setTimeout(function(){
							 var text="[åŒ¹é…]";
							 var cdate=new Date().getTime();
									// alert(cdate);
									// msgContent = text;
									time = cdate;
									from_id = $api.getStorage("id");
									var Cindex=chat.messageArr.length;
								//  chat.failSendMessageBody(text,"match",1);
								 //å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
								 api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
										 name: 'ChatListExec',
										 extra: {
												 targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
												 target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
												 type: 'match' ,    //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
												 content: text,
												 adjective_me: chat.adjective_me,
												 fate_me: chat.fate_me,
												 constellation1: chat.constellation1,
												 area_me: chat.area_me,
												 match: chat.match,
												 adjective: chat.adjective,
												 fate: chat.fate,
												 constellation2: chat.constellation2,
												 area: chat.area,
												 sex_me: chat.sex_me,
												 sex: chat.sex

										 }
								 });
								 //æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
								 api.addEventListener({
										 name: 'ChatListExecReturn'
								 }, function(ret, err){
										 if( ret ){
												 if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
														console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
												 }else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

														history.go(0);
														 msgToTop();
												 }
										 }else{
													alert( JSON.stringify( err ) );
										 }
								 });
						 },1200)
				}
					//åŒ¹é…æˆåŠŸåå‘é€æ¶ˆæ¯ è‡ªå·±çœ‹ä¸åˆ° åˆ«äººçœ‹å¾—åˆ°
			function  sendMatchMessage(content1,cotent2){
						 setTimeout(function(){
							 var text=content1;
							 var cdate=new Date().getTime();
									// alert(cdate);
									msgContent = text;
									time = cdate;
									from_id = $api.getStorage("id");
									var Cindex=chat.messageArr.length;
								 chat.failSendMessageBody(text,"txt2",1);
								 //å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
								 api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
										 name: 'ChatListExec',
										 extra: {
												 targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
												 target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
												 content: text,  //è¦å‘é€çš„æ¶ˆæ¯ä½“å†…å®¹
												 type: 'txt2'     //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
										 }
								 });
								 //æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
								 api.addEventListener({
										 name: 'ChatListExecReturn'
								 }, function(ret, err){
										 if( ret ){
												 if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
														console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
														if(chat.messageArr[Cindex-1] != null){                          //è¿™æ˜¯é˜²æ­¢ç”¨æˆ·ç‚¹å‡»å‘é€æ¶ˆæ¯è¿‡å¿«å‰é¢çš„è¿˜åœ¨è½¬åœˆ
															chat.messageArr[Cindex-1].msg_body.extras.fail="0"
														}
														if(chat.messageArr[Cindex-2] != null){
															chat.messageArr[Cindex-2].msg_body.extras.fail="0"
														}

															 chat.messageArr[Cindex].msg_body.extras.fail="0";   //å‘é€æ¶ˆæ¯æˆåŠŸæ˜¯æ¶ˆæ¯çš„åŠ è½½è½¬åœˆå»æ‰


												 }else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

														history.go(0);
														 msgToTop();
												 }
										 }else{
													alert( JSON.stringify( err ) );
										 }
								 });
						 },1200)
				}
      //ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›äº‘äº‘å‚¨å­˜å¹¶å‘é€å›¾ç‰‡æ¶ˆæ¯
			function uploadPic(picurl) {

        var Cindex;
      ///å‘é€å›¾ç‰‡

				var cdate=new Date().getTime();
					 // alert(cdate);
					 if($api.getStorage('language')=='zho'){
						 msgContent = "[åœ–ç‰‡]";
					 }else{
						 msgContent = "[Picture]";
					 }
					 time = cdate;
					 from_id = $api.getStorage("id");
					 Cindex=chat.messageArr.length;
					chat.failSendMessageBody(picurl,"img",1);
// }

				console.log(picurl);
				qiniu.upfile({
					file: picurl,
					name: "f8cc5f9956df68260156dffa4e9b0014" + (new Date).getTime(),
				}, function(ret, err) {
					// console.log("ä¸Šä¼ ä¸­");
					// alert(JSON.stringify(ret.info.key));
					if(ret.status == 1) {
						if(ret.oper == "complete") {
							// console.log(JSON.stringify(ret));

							qinniuKey = json['qiniu'] + ret.info.key;
							console.log("æˆåŠŸ"+qinniuKey);
											 // å‘é€æ¶ˆæ¯

											//å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
											api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
													name: 'ChatListExec',
													extra: {
															targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
															target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
															content: qinniuKey,  //è¦å‘é€çš„æ¶ˆæ¯ä½“å†…å®¹
															type: 'img'     //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
													}
											});

											//æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
											api.addEventListener({
													name: 'ChatListExecReturn'
											}, function(ret, err){
													if( ret ){
															if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
																 console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
																if(chat.messageArr[Cindex-1] != null){                          //è¿™æ˜¯é˜²æ­¢ç”¨æˆ·ç‚¹å‡»å‘é€æ¶ˆæ¯è¿‡å¿«å‰é¢çš„è¿˜åœ¨è½¬åœˆ
																	chat.messageArr[Cindex-1].msg_body.extras.fail="0"
																}
																if(chat.messageArr[Cindex-2] != null){
																	chat.messageArr[Cindex-2].msg_body.extras.fail="0"
																}

																	 chat.messageArr[Cindex].msg_body.extras.fail="0";   //å‘é€æ¶ˆæ¯æˆåŠŸæ˜¯æ¶ˆæ¯çš„åŠ è½½è½¬åœˆå»æ‰
																	chat.messageArr[Cindex].msg_body.text=ret.value.text;
																	 setTimeout(function() {
																		 msgToTop();   //å›åˆ°æœ€åº•éƒ¨ï¼Œå› ä¸ºå‘é€å›¾çš„å¤§å°è¦ç‚¹æ—¶é—´è·å–
																	 }, 500)
															}else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

		 													  history.go(0);
		 													 	 msgToTop();
		 												 }
													}else{
															 alert( JSON.stringify( err ) );
													}
											});


						}
					} else {
						alert("å‘é€å›¾ç‰‡å¤±è´¥");
					}
				});

			}

			//ç¿»è¯‘æ–‡å­—   word:ç¿»è¯‘çš„æ–‡æœ¬   target:ä¿¡æ¯å¯¹è±¡
	    function translate(word, target, context_type) {
	      //				if(target.context_type == 'audio' || target.context_type == 'video') {
	      //					return;
	      //				}
	      // var content_no = word.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\[(.*?)\]/g, "");
	      var content_no = word.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g, " ");
	          // content_no = content_no.replace(/\r|\n|&nbsp;/g," ");
	      var salt = (new Date).getTime();

	      // var str1 = json['baidu_appid'] + word + salt + json['baidu_key'];
	      var str1 = "20161226000034707" + content_no + salt + "i1XmNFcDa7_Z4i6jUSZA"; //æœ€åè¿™ä¸ªç­¾åçš„å­—ç¬¦ä¸²è¿™ä¸ªå¯è®©å›½é™…è¡¨æƒ…è¿›è¡Œå¿½ç•¥åç¿»è¯‘çš„
	      var sign = MD5(str1);
	      api.ajax({
	        url: 'http://api.fanyi.baidu.com/api/trans/vip/translate',
	        method: 'post',
	        data: {
	          values: {
	            q: content_no,
	            //appid: "20170419000045193",
	            appid: "20161226000034707",
	            salt: salt,
	            from: "auto",
	            to: chat.translateLang,
	            sign: sign
	          }
	        }
	      }, function(data, err) {
	        // alert(JSON.stringify(data));
	        if(data && data['trans_result']) {
	          // target.translated = "" + data['trans_result'][0]['dst'] + "";
	          var strings='';
	          for(var i=0;i<data['trans_result'].length;i++){  //å› ä¸ºç¿»è¯‘çš„æ–‡æœ¬é‡åˆ°æ¢è¡Œæˆ–è€…ç©ºå¾ˆæ ¼å°±ä¼šåˆ†æ®µç¿»è¯‘
	                strings=strings+data['trans_result'][i]['dst'];
	          }
	          target.translated=strings;
	        } else {
	          console.log(JSON.stringify(err) + '===ç¿»è¯‘å‡½æ•°è¿™é‡Œ');
	        }
	        // msgToTop();
	      });
	    }


				// onDis();
				//å…³é—­è¡¨æƒ…åŒ…
				function closeEmo(){
					api.closeFrame({
					    name: 'ownEmotion'
					});
				}
				UIChatBox.open({     //æ‰“å¼€è¾“å…¥æ³•çš„æ¨¡å—
					placeholder: '',
					maxRows: 4,
					emotionPath: 'widget://image/emotion',
					texts: {
						recordBtn: {
							normalTitle: warn_text.shuohua,
							activeTitle: warn_text.songkai
						},
						sendBtn: {
							title: warn_text.send
						}
					},
					styles: {
						recordBtn: {                        //JSONå¯¹è±¡ï¼›â€œæŒ‰ä½ å½•éŸ³â€æŒ‰é’®çš„æ ·å¼
		        normalBg: '#000000',            //ï¼ˆå¯é€‰é¡¹ï¼‰å­—ç¬¦ä¸²ç±»å‹ï¼›æŒ‰é’®å¸¸æ€çš„èƒŒæ™¯ï¼Œæ”¯æŒ rgbï¼Œrgbaï¼Œ#ï¼Œå›¾ç‰‡è·¯å¾„ï¼ˆæœ¬åœ°è·¯å¾„ï¼Œfs://ã€widget://ï¼‰ï¼›é»˜è®¤ï¼š'#c4c4c4'
		        activeBg: '#999999',            //ï¼ˆå¯é€‰é¡¹ï¼‰å­—ç¬¦ä¸²ç±»å‹ï¼›æŒ‰é’®æŒ‰ä¸‹æ—¶çš„èƒŒæ™¯ï¼Œæ”¯æŒ rgbï¼Œrgbaï¼Œ#ï¼Œå›¾ç‰‡è·¯å¾„ï¼ˆæœ¬åœ°è·¯å¾„ï¼Œfs://ã€widget://ï¼‰ï¼›é»˜è®¤ï¼š'#999999'ï¼›normalBg å’Œ activeBg å¿…é¡»ä¿æŒä¸€è‡´ï¼ŒåŒä¸ºé¢œè‰²å€¼ï¼Œæˆ–åŒä¸ºå›¾ç‰‡è·¯å¾„
		        color: '#000',                  //ï¼ˆå¯é€‰é¡¹ï¼‰å­—ç¬¦ä¸²ç±»å‹ï¼›æŒ‰é’®æ ‡é¢˜æ–‡å­—çš„é¢œè‰²ï¼Œæ”¯æŒ rgbï¼Œrgbaï¼Œ#ï¼Œé»˜è®¤ï¼š'#000000'
		        size: 14                        //ï¼ˆå¯é€‰é¡¹ï¼‰æ•°å­—ç±»å‹ï¼›æŒ‰é’®æ ‡é¢˜æ–‡å­—çš„å¤§å°ï¼Œé»˜è®¤ï¼š14
		   },
						topDivider:{
			          width:2,
			          color:'#efefef',
			        },
							inputBar: {
			          borderColor: '#efefef',
			          bgColor: '#FFFFFF'
			        },
			        inputBox: {
			          borderColor: '#B3B3B3',
			          bgColor: '#FFFFFF',
			          boardBgColor: '#FFFFFF',
			          topMargin:5
			        },
						emotionBtn: {
							normalImg: 'widget://image/emotion/aIcon/expression.png'
						},
						extrasBtn: {
							normalImg: 'widget://image/emotion/aIcon/plus.png'
						},
						keyboardBtn: {
							normalImg: 'widget://image/emotion/aIcon/keyboard.png'
						},
						speechBtn: {
							normalImg: 'widget://image/emotion/aIcon/microphone.png'
						},
						recordBtn: {
							normalBg: '#f2f2f2',
							activeBg: '#c4c4c4',
							color: '#aaa',
							size: 14
						},
						indicator: {
							target: 'both',
							color: '#c4c4c4',
							activeColor: '#9e9e9e'
						},
						sendBtn: {
							titleColor: '#fff',
							bg: '#e8b730',
							activeBg: '#c76f16',
							titleSize: 14
						}
					},
					extras: {
						titleSize: 10,
						titleColor: '#a3a3a3',
						isAdaptScreenSize:false,
						btns: [{
								title: 'åœ–ç‰‡',
								normalImg: 'widget://image/emotion/aIcon/pic.png',
							},
							{
								title: 'æ‹ç…§',
								normalImg: 'widget://image/emotion/aIcon/camera.png',
							},
							{
								title: 'è‡ªå®šç¾©è¡¨æƒ…',
								normalImg: 'widget://image/emotion/aIcon/emo.png',
							},
							{
								title: 'åˆ†äº«ç¾¤çµ„',
								normalImg: 'widget://image/emotion/aIcon/group.png',
							},
							{
								title: 'è§’è‰²æ‰®æ¼”',
								normalImg: 'widget://image/emotion/aIcon/group.png',
							}
						]
					}
				}, function(ret, err) {
					if(ret) {
											// alert(JSON.stringify(ret));
						// å‘é€æ–‡æœ¬æ¶ˆæ¯
						if(ret.eventType === "send" && ret.msg !== "") {
					  var	errhistory=ret.msg;
				       var cdate=new Date().getTime();
							    // alert(cdate);
								  msgContent = ret.msg;
									time = cdate;
									from_id = $api.getStorage("id");
									var Cindex=chat.messageArr.length;
                 chat.failSendMessageBody(ret.msg,"txt",1);
								 //å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
								 api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
								     name: 'ChatListExec',
								     extra: {
								         targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
												 target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
								         content: ret.msg,  //è¦å‘é€çš„æ¶ˆæ¯ä½“å†…å®¹
												 type: 'txt'     //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
								     }
								 });
								 //æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
								 api.addEventListener({
								     name: 'ChatListExecReturn'
								 }, function(ret, err){
								     if( ret ){
								         if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
													  console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
														if(chat.messageArr[Cindex-1] != null){                          //è¿™æ˜¯é˜²æ­¢ç”¨æˆ·ç‚¹å‡»å‘é€æ¶ˆæ¯è¿‡å¿«å‰é¢çš„è¿˜åœ¨è½¬åœˆ
															chat.messageArr[Cindex-1].msg_body.extras.fail="0"
														}
														if(chat.messageArr[Cindex-2] != null){
															chat.messageArr[Cindex-2].msg_body.extras.fail="0"
														}

															 chat.messageArr[Cindex].msg_body.extras.fail="0";   //å‘é€æ¶ˆæ¯æˆåŠŸæ˜¯æ¶ˆæ¯çš„åŠ è½½è½¬åœˆå»æ‰


												 }else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

													  history.go(0);
													 	 msgToTop();
												 }
								     }else{
								          alert( JSON.stringify( err ) );
								     }
								 });


			}
						//æ‰“å¼€ç›¸å†Œ
						if(ret.index == 0) {
								UIMediaScanner = api.require('UIMediaScanner');
								if(api.systemType=="ios"){
										//æ‰“å¼€ç›¸å†Œå¹¶å‘é€å›¾ç‰‡
										openAndsendPic();
								}else{
									//ç”³è¯·ç›¸å†Œæƒé™
								api.requestPermission({
										list: ["storage"],
								}, function(ret, err) {
											if(ret.list[0].granted){
												//æ‰“å¼€ç›¸å†Œå¹¶å‘é€å›¾ç‰‡
												openAndsendPic();

											}


								});

						}


						}
						//æ‰“å¼€ç›¸æœº
						if(ret.index == 1) {

						// fnrequestPermission("camera");

					// 		var resultList = api.hasPermission({
					//     list:['camera']
					// });
					// if(resultList[0].granted==false){
					// 	return;
					// }

					if(api.systemType=="ios"){

														api.getPicture({
															sourceType: 'camera',
															encodingType: 'jpg',
															mediaValue: 'pic',
															destinationType: 'url',
															allowEdit: true,
															preview: true, //æè¿°ï¼šï¼ˆå¯é€‰é¡¹ï¼‰æ˜¯å¦é€‰æ‹©å›¾ç‰‡åè¿›è¡Œé¢„è§ˆï¼Œåªæ”¯æŒiOSã€‚
															quality: 50,
															saveToPhotoAlbum: true
														}, function(ret, err) {
															if(ret) {
																								// alert(JSON.stringify(ret.data));
																	if(ret.data!=""){
																			uploadPic(ret.data);
																	}

															} else {
																alert(JSON.stringify(err));
															}
														});


					}else{

							//è¯·æ±‚ç›¸æœºçš„æƒé™
						api.requestPermission({
								list: ["camera"],
						}, function(ret, err) {
							//å…è®¸åæ‰å¯ä»¥æ‰“å¼€ç›¸æœº
						if(ret.list[0].granted==true){
														api.getPicture({
															sourceType: 'camera',
															encodingType: 'jpg',
															mediaValue: 'pic',
															destinationType: 'url',
															allowEdit: true,
															preview: true, //æè¿°ï¼šï¼ˆå¯é€‰é¡¹ï¼‰æ˜¯å¦é€‰æ‹©å›¾ç‰‡åè¿›è¡Œé¢„è§ˆï¼Œåªæ”¯æŒiOSã€‚
															quality: 50,
															saveToPhotoAlbum: true
														}, function(ret, err) {
															if(ret) {
																								// alert(JSON.stringify(ret.data));
																	if(ret.data!=""){
																			uploadPic(ret.data);
																	}

															} else {
																alert(JSON.stringify(err));
															}
														});
											}


								});





					}


						}
						// æ‰“å¼€è¡¨æƒ…åŒ…é¡µé¢
					   if(ret.index==2){
							 var chat2=$api.dom("#chat");
							 var maxHeight = window.innerHeight;
								var height = maxHeight-chat.panelHeight;
								if(hhh/www>2){
									height = height-34+25;
								}
								// alert(JSON.stringify(chat.emotion));
							 	api.openFrame({
							 	    name: 'ownEmotion',
							 	    url: './ownEmotion.html',
							 	    rect: {
							 	        x: 0,
							 	        y: height,
							 	        w: 'auto',
							 	        h: chat.panelHeight
							 	    },
							 	    pageParam: {
							 	        emotion: chat.emotion,
												type: 1,   //1ä»£è¡¨ å•èŠé¡µé¢æ‰“å¼€è¡¨æƒ…åŒ…  2ä»£è¡¨ç¾¤èŠé¡µé¢æ‰“å¼€çš„
												height: height
							 	    },
							 	    bounces: false,
							 	    bgColor: '#efefef',
							 	    vScrollBarEnabled: false,
							 	    hScrollBarEnabled: false
							 	});

						 }
						 if(ret.index==3){
							 api.openWin({
							     name: 'appshare',
							     url: 'widget://html/chat/appshare.html',
							     pageParam: {
							         share: "shareGroup",
											 type: "chat2",
											 otherId: chat.targetId
							     }
							 });

						 }
						if(ret.index==4){
							api.openWin({
							    name: 'roleType',
							    url: './roleType.html',
							    pageParam: {
							        roleplay: true
							    }
							});
						api.addEventListener({
						    name: 'roleplay'
						}, function(ret, err){
						    if( ret ){
									api.ajax({
										 url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/userinfo',
										 method: 'post',
										 data: {
												 values: {
														 uiId: chat.ownId,
														 pageUiId: chat.ownId
												 }
										 }
								 },function(ret, err){
										 if (ret) {
												 // alert( JSON.stringify( ret ) );
												 api.sendEvent({
														 name: 'ChatListExec',
														 extra: {
																 content: '[è§’è‰²æ‰®æ¼”]',
																 targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
																 target_username: chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
																 data: ret.data,
																 type: 'couple',     //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
														 }
												 });
												 //ç›‘å¬chat_list æå…‰å‘é€æ¶ˆæ¯å‘é€æˆåŠŸ
												 api.addEventListener({
														 name: 'ChatListExecReturn'
												 }, function(ret, err){
														 if( ret ){
															 var data = ret.value.data;
																 if(ret.value.state == 1){
																	 api.toast({
																			 msg: 'å‘é€æˆåŠŸ',
																			 duration: 2000,
																			 location: 'bottom'
																	 });
																	 chat.failSendMessageBody('[è§’è‰²æ‰®æ¼”]',"couple",1,'','','','',data);
																 }
														 }
												 });
										 }
								 });
						    }
						});
						}
					} else {
						alert(JSON.stringify(err));
					}

				});
				if($api.getStorage('language')!='zho'){
					UIChatBox.reloadExtraBoard({
						    extras: {
						        titleSize: 10,
						        titleColor: '#a3a3a3',
										isAdaptScreenSize:false,
						        btns: [{
						            title: 'Picture',
						            normalImg: 'widget://image/emotion/aIcon/pic.png'
						      	  }, {
						            title: 'Camera',
						            normalImg: 'widget://image/emotion/aIcon/camera.png'
						        	}, {
											title: 'Expression',
											normalImg: 'widget://image/emotion/aIcon/emo.png'
										},{
											 title: 'ShareGroup',
											 normalImg: 'widget://image/emotion/aIcon/group.png'
										 }
										 ,{
												title: 'RolePlay',
												normalImg: 'widget://image/emotion/aIcon/group.png',
											}
										]
						    }
						});
				}
				//ç‚¹å‡»è¾“å…¥æ¡† å·¦å³çš„ è¡¨æƒ…ï¼Œå½•éŸ³ï¼Œé™„åŠ åŠŸèƒ½å›¾æ ‡ æ—¶  å…³é—­è¡¨æƒ…åŒ…é¡µé¢
				UIChatBox.addEventListener({
				    target: 'inputBar',
				    name: 'showExtras'
				}, function(ret, err){
				    if( ret ){
				      closeEmo();
				    }
				});
				UIChatBox.addEventListener({
				    target: 'inputBar',
				    name: 'showEmotion'
				}, function(ret, err){
				    if( ret ){
						closeEmo();
				    }
				});
				UIChatBox.addEventListener({
				    target: 'inputBar',
				    name: 'showRecord'
				}, function(ret, err){
				    if( ret ){
				        closeEmo();

				    }
				});

			// ç›‘å¬ inputBar  æ”¹å˜èŠå¤©ç•Œé¢é«˜åº¦
			// coding...
			UIChatBox.addEventListener({
				target: 'inputBar',
				name: 'move'
			}, function(ret, err) {
				if(ret) {
					console.log(JSON.stringify(ret));
					chat.panelHeight=ret.panelHeight;//è·å–ä½ é™„åŠ åŠŸèƒ½æŒ‰é’®æ—¶é”®ç›˜çš„é«˜åº¦ï¼Œæ‰“å¼€è¡¨æƒ…é¡µé¢æ—¶ç”¨åˆ°
					// alert(chat.panelHeight);
					chat.h=chat.panelHeight+70;
					if(api.systemType=='ios'){
						// alert("???");
						$(".redBox").css({
							'position':'fixed',
							'right':'50%',
							'bottom':chat.h,
							'margin-left':'35px'
						});
					}
					var main = $api.dom('.main');
					var mainH = $api.offset(main).h;
					// console.log(mainH);
					//å› ä¸ºiosä¸‹é”®ç›˜å¼¹å‡º ä¼šè§¦å‘ä¸¤æ¬¡
					if(moveLock && ret['panelHeight'] > 0) {
						$api.css(main, 'height:' + (mainH - ret['panelHeight'] - iosH) + 'px');
												setTimeout(function() {
													main.scrollTop = main.scrollHeight;
												}, 50);
						msgToTop();
						moveLock = false;
					} else if(!moveLock && ret['panelHeight'] === 0) {
						$api.css(main, 'height:83vh');
						moveLock = true;
						msgToTop();
					}
				} else {
					console.log(JSON.stringify(err) + 'è¾“å…¥æ¡†æ¨¡å—æœ‰è¯¯');
				}
			});

			//ç›‘å¬å½•éŸ³æŒ‰é’®æŒ‰ä¸‹äº‹ä»¶ï¼Œè¿›è¡Œå½•éŸ³
						UIChatBox.addEventListener({
					target: 'recordBtn',
					name: 'press'
			}, function(ret, err) {
					if (ret) {
						audioStreamer.stop();
						api.startRecord({

				});
				//  bin=$api.dom(".bin");
				 $api.css(bin1, "display:block");
				 $api.css(bin1, "background-image:url("+warn_text.luzhi+")");

				//  bin1.css('display', 'block');
				//  bin1.css('background-image', 'url("../../image/emotion/Expression_4.png")');

				// api.toast({
				// 		msg: 'å½•éŸ³æŒ‰é’®æŒ‰ä¸‹',
				// 		duration: 2000,
				// 		location: 'bottom'
				// });
					} else {


					}
			});
			//æ¾å¼€æŒ‰é’®äº‹ä»¶ç›‘å¬

							UIChatBox.addEventListener({
						target: 'recordBtn',
						name: 'press_cancel'
				}, function(ret, err) {
						if (ret) {

									if(api.systemType=="android"){  //ç”³è¯·å½•éŸ³æƒé™
										     fnrequestPermission("microphone");
							        }
								$api.css(bin1, "display:none");
								// alert(invalidvoice);
								if(!invalidvoice){ //ä¸æ˜¯æ— æ•ˆè¯­éŸ³åŠå¯å‘é€



							api.stopRecord(function(ret, err) {
								// alert(JSON.stringify(ret));
														if (ret) {
															if(ret.duration<1){
																api.toast({
																		msg: warn_text.short,
																		duration: 2000,
																		location: 'bottom'
																});
																return;
															}
															if(ret.duration>60){
																	api.toast({
																			msg: warn_text.long,
																			duration: 2000,
																			location: 'bottom'
																	});
																	return;

															}
												var path = ret.path;
												var duration = ret.duration;
			console.log("å³å°†å¼€å§‹ä¸Šä¼ ");
												qiniu.upfile({
													file: path,
													name: ""+$api.getStorage('id') + (new Date).getTime()+".amr",
												}, function(ret, err) {

													if(ret.status == 1) {
														if(ret.oper == "complete") {
															console.log(ret['info']['key']);
															qinniuKey =ret.info.key;
																var cdate=new Date().getTime();
																	 // alert(cdate);
																	 if($api.getStorage('language')=='zho'){
																		 msgContent = "[èªéŸ³]";
																	 }else{
																		 msgContent = "[Voice]";
																	 }
																	 time = cdate;
																	 from_id = $api.getStorage("id");
																	 var Cindex=chat.messageArr.length;
																	chat.failSendMessageBody(qinniuKey,"voice",1,duration);


																console.log("ä¸Šä¼ å›¾ç‰‡æˆåŠŸ:"+qinniuKey);
																//å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
																api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
																		name: 'ChatListExec',
																		extra: {
																				targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
																				target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
																				content: qinniuKey,  //è¦å‘é€çš„æ¶ˆæ¯ä½“å†…å®¹
																				type: 'voice',    //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
																				duration: duration
																		}
																});

																//æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
																api.addEventListener({
																		name: 'ChatListExecReturn'
																}, function(ret, err){
																		if( ret ){
																				if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
																					 console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
																					 if(chat.messageArr[Cindex-1] != null){                          //è¿™æ˜¯é˜²æ­¢ç”¨æˆ·ç‚¹å‡»å‘é€æ¶ˆæ¯è¿‡å¿«å‰é¢çš„è¿˜åœ¨è½¬åœˆ
																						 chat.messageArr[Cindex-1].msg_body.extras.fail="0"
																					 }
																					 if(chat.messageArr[Cindex-2] != null){
																						 chat.messageArr[Cindex-2].msg_body.extras.fail="0"
																					 }

																							chat.messageArr[Cindex].msg_body.extras.fail="0";   //å‘é€æ¶ˆæ¯æˆåŠŸæ˜¯æ¶ˆæ¯çš„åŠ è½½è½¬åœˆå»æ‰


																				}else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

							 													  history.go(0);
							 													 	 msgToTop();
							 												 }
																		}else{
																				 alert( JSON.stringify( err ) );
																		}
																});
											      	}
											    	} else {
												alert("å›¾ç‰‡ä¸Šä¼ è¿‡ç¨‹å¤±è´¥ï¼Œæ— æ³•å‘é€");
											  	}
												});
										}
									});

								}
                 	invalidvoice=false;//è®©è¯­éŸ³å¯ä»¥å‘é€
						} else {


						}
				});
				//æŒ‰ä¸‹å½•éŸ³æŒ‰é’®åï¼Œä»æŒ‰é’®ç§»å‡º
								UIChatBox.addEventListener({
							target: 'recordBtn',
							name: 'move_out'
					}, function(ret, err) {
							if (ret) {
								$api.css(bin1, "background-image:url("+warn_text.quxiao+")");
								// api.toast({
								// 		msg: 'æŒ‰ä¸‹å½•éŸ³æŒ‰é’®å,ä»æŒ‰é’®ç§»å‡º',
								// 		duration: 2000,
								// 		location: 'bottom'
								// });

							} else {


							}
					});
					//æŒ‰ä¸‹å½•éŸ³æŒ‰é’®åï¼Œä»æŒ‰é’®ç§»å‡ºå¹¶æ¾å¼€æŒ‰é’®
					UIChatBox.addEventListener({
				target: 'recordBtn',
				name: 'move_out_cancel'
		}, function(ret, err) {
				if (ret) {
					//åœæ­¢å½•éŸ³
					invalidvoice=true; //true ä»£è¡¨è¯­éŸ³ä¸å‘é€
					// alert("ä½ å¥½");
						$api.css(bin1, "display:none");
					api.stopRecord(function(ret, err) {});



				} else {


				}
		});
		//æŒ‰ä¸‹å½•éŸ³æŒ‰é’®åï¼Œä»æŒ‰é’®ç§»å‡º
						UIChatBox.addEventListener({
					target: 'recordBtn',
					name: 'move_in'
			}, function(ret, err) {
					if (ret) {
						$api.css(bin1, "background-image:url("+warn_text.luzhi+")");
					} else {


					}
			});
			//æŸ¥è¯¢å¯¹é¢æœ‰æ²¡æœ‰æŠŠè‡ªå·±ç»™ä¸¾æŠ¥äº†å’Œè‡ªå·±æœ‰æ²¡æœ‰è¢«ç¦è¨€
			api.ajax({
					url: 'http://api.baopinghui.com/app_Blacklist/chat_isPushBlacklistAndBan',
					method: 'post',
					data: {
							values: {
									uiid: $api.getStorage('id'),
									target_uiid: api.pageParam["uiId"]
							}
					}
			},function(ret, err){
					if (ret) {
						var istrue = ret.data.istrue;
						var isban = ret.data.isban;
							if(isban==true){
								api.openFrame({
										name: 'guide9.5(new)',
										url: '../guide/guide9.5(new).html',
										rect: {
												x: 0,
												y: 0,
												w: 'auto',
												h: 'auto'
										},
										pageParam: {
												isban: ret.data.isban,
												date: ret.data.date, //è¢«5ä¸ªäººæˆ–10ä¸ªäººä¸¾æŠ¥
												timer: ret.data.timer
										},
										bounces: false,
										bgColor: 'rgba(0,0,0,0)',
										vScrollBarEnabled: false,
										hScrollBarEnabled: false
								});
							}else{
								//æŸ¥è¯¢è‡ªå·±æœ‰æ²¡æœ‰æŠŠå¯¹é¢ä¸¾æŠ¥
								api.ajax({
										url: 'http://api.baopinghui.com/app_Blacklist/chat_isPushBlacklistAndBan',
										method: 'post',
										data: {
												values: {
													uiid: api.pageParam["uiId"],
													target_uiid: $api.getStorage('id')
												}
										}
								},function(ret, err){
										if (ret) {
												var blackUser = ret.data.istrue;
												//æˆ‘æŠŠå¯¹é¢ä¸¾æŠ¥äº†
												if(blackUser){
													api.openFrame({
															name: 'guide9.5(new)',
															url: '../guide/guide9.5(new).html',
															rect: {
																	x: 0,
																	y: 0,
																	w: 'auto',
																	h: 'auto'
															},
															pageParam: {
																	blackUser: blackUser //æŠŠæŸäººä¸¾æŠ¥äº†
															},
															bounces: false,
															bgColor: 'rgba(0,0,0,0)',
															vScrollBarEnabled: false,
															hScrollBarEnabled: false
													});
													//å¯¹é¢æŠŠæˆ‘ç»™ä¸¾æŠ¥äº†
												}else if(istrue){
													api.openFrame({
															name: 'guide9.5(new)',
															url: '../guide/guide9.5(new).html',
															rect: {
																	x: 0,
																	y: 0,
																	w: 'auto',
																	h: 'auto'
															},
															pageParam: {
																	istrue: istrue
															},
															bounces: false,
															bgColor: 'rgba(0,0,0,0)',
															vScrollBarEnabled: false,
															hScrollBarEnabled: false
													});
												}
										}
								});
							}
					}
			});
			//åˆ¤æ–­åŒ¹é…é¡µé¢ä¼ è¿‡æ¥çš„
				function judge(){
					if(chat.age>=2010){
						chat.adjective=adjective_text.oneZero;
					}else if(chat.age>=2005&&chat.age<2010){
						chat.adjective=adjective_text.zeroFive;
					}else if(chat.age>=2000&&chat.age<2005){
						chat.adjective=adjective_text.zeroZero;
					}else if(chat.age>=1995&&chat.age<2000){
						chat.adjective=adjective_text.nineFive;
					}else if(chat.age>=1990&&chat.age<1995){
						chat.adjective=adjective_text.nineZero;
					}else if(chat.age>=1985&&chat.age<1990){
						chat.adjective=adjective_text.eightFive;
					}else if(chat.age>=1980&&chat.age<1985){
						chat.adjective=adjective_text.eightZero;
					}else if(chat.age>=1975&&chat.age<1980){
						chat.adjective=adjective_text.sevenFive;
					}else if(chat.age>=1970&&chat.age<1975){
						chat.adjective=adjective_text.sevenZero;
					}else if(chat.age>=1965&&chat.age<1970){
						chat.adjective=adjective_text.sixFive;
					}else if(chat.age>=1960&&chat.age<1965){
						chat.adjective=adjective_text.sixZero;
					}else {
						chat.adjective=adjective_text.other;
					}
				}
				function judge2(){
					if(chat.age_me>=2010){
						chat.adjective_me=adjective_text.oneZero;
					}else if(chat.age_me>=2005&&chat.age_me<2010){
						chat.adjective_me=adjective_text.zeroFive;
					}else if(chat.age_me>=2000&&chat.age_me<2005){
						chat.adjective_me=adjective_text.zeroZero;
					}else if(chat.age_me>=1995&&chat.age_me<2000){
						chat.adjective_me=adjective_text.nineFive;
					}else if(chat.age_me>=1990&&chat.age_me<1995){
						chat.adjective_me=adjective_text.nineZero;
					}else if(chat.age_me>=1985&&chat.age_me<1990){
						chat.adjective_me=adjective_text.eightFive;
					}else if(chat.age_me>=1980&&chat.age_me<1985){
						chat.adjective_me=adjective_text.eightZero;
					}else if(chat.age_me>=1975&&chat.age_me<1980){
						chat.adjective_me=adjective_text.sevenFive;
					}else if(chat.age_me>=1970&&chat.age_me<1975){
						chat.adjective_me=adjective_text.sevenZero;
					}else if(chat.age_me>=1965&&chat.age_me<1970){
						chat.adjective_me=adjective_text.sixFive;
					}else if(chat.age_me>=1960&&chat.age_me<1965){
						chat.adjective_me=adjective_text.sixZero;
					}else {
						chat.adjective_me=adjective_text.other;
					}
				}
			 chat = new Vue({
				el: "#chat",
				data: {
					ownId: $api.getStorage('id'), //è‡ªå·±çš„id
					targetId: api.pageParam['uiId'], //åˆ«äººçš„id
					nickname: api.pageParam['nickname'], //èŠå¤©å¯¹è±¡çš„åå­—
					cursor: "", //æ ‡è¯†
					messageArr: [], //æ¶ˆæ¯æ•°ç»„
					SmessageArr:(typeof($api.getStorage(SMessages))!="undefined")?$api.getStorage(SMessages):[],
					// SmessageArr:[],
					redBoxVal:0,//è®¾ç½®æœªè¯»æ•°
					number:50,//èµ·æ­¥åŠ è½½çš„ä¿¡æ¯æ•°50ï¼Œåé¢é€æ¸åŠ ä¸Š number_stage
					number_stage:50,//æ¯æ¬¡åŠ è½½çš„ä¿¡æ¯æ•°
					img: "img",
					txt: "txt",
					share: "share",
					matchs: 'match',
					translateLang: '', //é€‰æ‹©ç¿»è¯‘çš„è¯­è¨€
					isLoading: true, //æ˜¯å¦åŠ è½½ä¸­
					moreListShow: false, //ç¿»è¯‘åŠŸèƒ½æ˜¾ç¤ºå·²ç°åœ¨å·²ä¸ç”¨
					age: api.pageParam['age'],//å‘é€ç»™åˆ«äººçœ‹çš„
					age_me:0,//åˆ«äººçœ‹åˆ°çš„å¹´é¾„é»˜è®¤0
					area: api.pageParam['area'],
					constellation2: '',//åŒ¹é…ç”¨æˆ·å¯¹è±¡çš„æ˜Ÿåº§
					constellation1: '',//è‡ªå·±çš„æ˜Ÿåº§
					avatar: avatar,//åŒ¹é…é¡µé¢è¿‡æ¥çš„å¤´åƒ
					avatar_mine: $api.getStorage('avatar'),//è‡ªå·±çš„å¤´åƒ
					fate: api.pageParam['fate'],//åŒ¹é…çš„å‘½è¿æ•°
					adjective: '',	//å‘é€ç»™åˆ«äººçœ‹åˆ°çš„åŒ¹é…ä¿¡æ¯
					adjective_me: '',//åˆ«äººçœ‹åˆ°çš„åŒ¹é…æ€§æ ¼å¹´é¾„
					area_me: '',	//åŒ¹é…ååˆ«äººçœ‹åˆ°è‡ªå·±çš„åœ°åŒº
					fate_me:'',//åˆ«äººçœ‹åˆ°çš„åè¿æ•°å­—
					matching: api.pageParam["matching"],//åŒ¹é…é¡µé¢ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œé»˜è®¤trueæ—¶ æ˜¾ç¤ºåŒ¹é…ä¿¡æ¯
					match:0,//åŒ¹é…çš„ç™¾åˆ†æ•°
					sex_me:'',//åˆ«äººçœ‹åˆ°çš„æ€§åˆ«
					sex: api.pageParam["sex"],//è‡ªå·±çœ‹åˆ°çš„æ€§åˆ«
					adjText:{'zho':['æ˜¯ å¯ æ„› æ´» æ½‘ çš„ 10 å','æ˜¯ å¤© çœŸ æµª æ¼« çš„ 05 å','æ˜¯ å¯Œ æœ‰ å‰µ é€  åŠ› çš„ 00 å','æ˜¯ ç†± æƒ… å¹´ è¼• çš„ 95 å','æ˜¯ å€‹ æ€§ é®® æ˜ çš„ 90 å','æ˜¯ ç© æ¥µ å‘ ä¸Š çš„ 85 å','æ˜¯ æ¸´ æœ› è‡ª ç”± çš„ 80 å','æ˜¯ æ¨‚ è§€ è± é” çš„ 75 å','æ˜¯ ç¨ ç«‹ ä¸ ç¾ çš„ 70 å','æ˜¯ æˆ ç†Ÿ ç©© é‡ çš„ 65 å','æ˜¯ æ²ˆ è‘— å†· éœ çš„ 60 å','æ˜¯ é‚Š ç·£ äºº å£«'],
				'en':['was born in the 2010s','was born in the 2005s','was born in the 2000s','was born in the 1995s','was born in the 1990s', 'was born in the 1985s','was born in the 1980s','was born in the 1975s','was born in the 1970s','was born in the 1965s','was born in the 1960s','was born in  Mars']},
					emotion:[],
					panelHeight:0,//è¡¨æƒ…åŒ…é¡µé¢é€‚åº”é«˜åº¦
					h:0,//æœªè¯»æ¶ˆæ¯çš„é«˜åº¦ï¼Œioså’Œå®‰å“åœ¨å®šä½ä¸Šä½ç½®ä¸åŒï¼Œæ‰“å¼€é”®ç›˜çš„æ—¶å€™éœ€è¦æ ¹æ®æƒ…å†µå»æ›´æ”¹é«˜åº¦ï¼Œä¸ç„¶ä¼šè¢«é®ä½
			},
			mounted:function(){
	    	window.addEventListener('scroll',this.huadong,true);
							},
				watch: {
					translateLang: function(lang, oldLang) { //ç¿»è¯‘è¯­è¨€
						// if(lang) {
						// 	for(var i = 0, len = this.messageArr.length; i < len; i++) {
						// 		translate(this.messageArr[i].msg_body.text, this.messageArr[i]);
						// 	}
						// }
					}
				},

				methods: {
					commonHabbies: function(msg){
						if($api.getStorage('language')=='zho'){
							var mes = "ä½ ä»¬éƒ½å–œæ¬¢<br/>-<br/>" ;
						}else{
							var mes = "You all like<br/>-<br/>";
						}
						var habbies = [];
						for(var i=0;i<msg.length;i++){
							if($api.getStorage('language')=='zho'){
								habbies.push(hobbyZ[msg[i]]);
							}else{
								habbies.push(hobbyE[msg[i]]);
							}
						}
						return mes + habbies.toString();
					},
					rolePage: function(){
						api.openWin({
						    name: 'rolePage',
						    url: './rolePage.html',
						    pageParam: {
						        name: 'test'
						    }
						});

					},
					//æ‰“å¼€è§’è‰²æ‰®æ¼”é¡µé¢
					openRole: function(data){
						if(data.id == chat.ownId){
							return;
						}
						api.openWin({
						    name: 'rolePlay',
						    url: './rolePlay.html',
						    pageParam: {
						        data: data
						    }
						});

					},
					hid: function(msg){
						var hid;
						if(msg.from_id==chat.ownId&&msg.target_id==chat.targetId&&msg.msg_body.extras.type=='txt'){
						  hid = true;
						}
								if(msg.from_id==chat.ownId&&msg.msg_body.extras.hidden=='yes'){
										hid = false;
								}
							return hid;
					},
					// sharePic: function(avatar){
					// 	// alert(avatar);
					// 	return {
					// 		backgroundImage: 'url('+ avatar+ ')',
					// 	}
					// },
					openGroup: function(ggid){
							api.openWin({
							    name: 'group-setting',
							    url: 'widget://html/group/group-setting.html',
							    pageParam: {
							        gid: ggid,
											shareGroup: 'shareGroup'
							    }
							});

					},
					//ç”¨äºæŠŠçª—å£å®šä½åœ¨åŸå†å²æ¶ˆæ¯çš„å¤´éƒ¨
					dingwei:function(){
						// return;
						var main=$api.dom('.main');

						// var $bin= $("#bin").css('display', 'none');
						var height_old=main.scrollHeight-main.scrollTop;
						chat.number+=chat.number_stage;
						var uuid=$api.getStorage('id'); //è‡ªå·±çš„id
						var otherId=api.pageParam['uiId'];//å½“å‰èŠå¤©å¯¹è±¡çš„id
						var aa=new Date().getTime();
							var msgs=db.selectSqlSync({
									name: 'tinkle',
									sql: "select * from tin_im_message where userid in ('"+uuid+"','"+otherId+"') and from_id in ('"+uuid+"','"+otherId+"') and target_id in ('"+uuid+"','"+otherId+"') order by ctime_ms desc limit "+(chat.number-chat.number_stage)+","+chat.number_stage
									// sql:"select * from tin_im_message where userid='sdfasdfasdf'"

							});

							console.log(":::::::::::::::::::::"+((new Date().getTime())-aa));
									 msgs.data.reverse();//å€’åº
							// alert(JSON.stringify(msgs));
							for(var i=0;i<msgs.data.length;i++){
									 msgs.data[i].msg_body=JSON.parse(msgs.data[i].msg_body);
									 msgs.data[i].create_time=Number(msgs.data[i].create_time);
									 msgs.data[i].translated="";
							}
						chat.messageArr=msgs.data.concat(chat.messageArr);
						setTimeout(function(){
							if(toggle8){  //å¿…é¡»æ˜¯æœ‰å†å²æ¶ˆæ¯æ‰æœ‰æ•ˆ
								// alert("a");
									main.scrollTop=main.scrollHeight-height_old;
							}
							if(msgs.data.length<chat.number_stage){
								toggle8=false; //è¡¨ç¤ºå·²ç»æ²¡æœ‰æ¶ˆæ¯äº†
							}
					 },10)
								// msgToTop();

						// alert("aa");
				},
					huadong:function(){
						var main=$api.dom('.main'); //scrollTopæ»šåŠ¨ç°åœ¨çš„é¡¶éƒ¨ä½ç½®  clientHeightè¿™ä¸ªdomçš„é«˜åº¦ scrollHeightå¯ä»¥æ»šåŠ¨çš„æ€»é•¿åº¦
							var dingwei=$('.dingwei');
					//  console.log("åˆ°é¡¶");
				 if(main.scrollTop<50){
					 if(toggle10){
						 toggle10=false;

						 if(toggle8){     //å¦‚æœå·²æ²¡æœ‰å†å²æ¶ˆæ¯äº†å°±ä¸æ˜¾ç¤ºè½¬åœˆåŠ è½½
									$(".dingwei").css('display', 'block');
								}
						// dingwei.html("<img class='tips1' src=''../../icon/messages/loading.gif'/>");
							 // alert("aaa");
							//  alert("a");
							 setTimeout(function(){
								 chat.dingwei();
									 // alert("2");
									$(".dingwei").css('display', 'none');
									// dingwei.html("<p >   Chat Content Will Be Deleted After 7 Days   </p>");
									toggle10=true;
							 },40)
					 }
				 }
					 if(main.scrollTop+main.clientHeight>main.scrollHeight-50){  //åˆ¤æ–­æ˜¯å¦æ¥è¿‘åº•éƒ¨
						 chat.redBoxVal=0; //æœªè¯»æ•°çº¢ç‚¹éšè—
						 $('.redBox').css('display','none');
				//  console.log("åˆ°åº•äº†");
					 }
					},
					//å…³é—­è¡¨æƒ…åŒ…
					closeEmo: function(){
						api.closeFrame({
						    name: 'ownEmotion'
						});

					},
					//æ–°æ¶ˆæ¯ç½®é¡¶
					zhiding: function(){
						chat.redBoxVal=0;
						$('.redBox').css('display','none');
						msgToTop();
					},
					//æ·»åŠ è¡¨æƒ…
					addEmotion: function(imgUrl){
						//åˆ¤æ–­è¦æ·»åŠ çš„è¡¨æƒ…æ˜¯ä¸æ˜¯å­˜åœ¨è¡¨æƒ…åŒ…ä¸­
						// exist=chat.emotion.indexOf(imgUrl);
						api.ajax({
								url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/selectEmoji',
								method: 'post',
								data: {
										values: {
												uiid: chat.ownId
										}
								}
						},function(ret, err){
								if (ret) {
									var emoji;
									if(ret.data.emoji!=""){
										emoji=ret.data.emoji.split(",");
										// chat.emotion=emoji;
										emoji.reverse();//ç¿»è½¬è¡¨æƒ…åŒ…æ•°ç»„ï¼Œè®©æ–°æ·»åŠ çš„é‚£ä¸ªè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®
									}else{
										emoji=[];
									}
										for(var i=0;i<emoji.length;i++){
											if(emoji[i]==imgUrl){
											console.log("è¡¨æƒ…å·²å­˜åœ¨");
												return;
											}
										}
										api.ajax({
												url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/addEmoji',
												method: 'post',
												data: {
														values: {
																uiid:chat.ownId,
																str:imgUrl
														}
												}
										},function(ret, err){
												if (ret) {
													console.log("æ·»åŠ è¡¨æƒ…æˆåŠŸ");
													console.log(JSON.stringify(emoji));
												} else {
														alert( JSON.stringify( err ) );
												}
										});
								}
						});
					},
					//è®¾ç½®å¤´åƒ
					getPic: function(avatar) {
						return {
							backgroundImage: 'url('+'http://bin.baopinghui.com/'+ avatar+ '?imageView2/0/w/100)',
						}
					},
					//åŒ¹é…åˆ¤æ–­æ€§æ ¼å¹´é¾„æè¿°ä¸­è‹±ç¿»è¯‘
					adjJudge: function(word){
							for(var i=0;i<chat.adjText.zho.length;i++){
								if(word==chat.adjText.zho[i]){
									if($api.getStorage('language')=='zho'){
										return chat.adjText.zho[i];
									}else{
										return chat.adjText.en[i];
									}
								}else if(word==chat.adjText.en[i]){
									if($api.getStorage('language')=='zho'){
										return chat.adjText.zho[i];
									}else{
										return chat.adjText.en[i];
									}
								}
							}
					},
					//åˆ¤æ–­åŒ¹é…çš„æ€§åˆ«ä¸­è‹±ç¿»è¯‘
					sexJudge : function(a){
						if ($api.getStorage("language") == "zho") {
								if(a=='He'){
									return 'ä»– ';
								}else if(a=='She'){
									return 'å¥¹ ';
								}else if(a=='ä»–'){
									return 'ä»– ';
								}else if(a=='å¥¹'){
									return 'å¥¹ ';
								}
						 }else{
							 if(a=='ä»–'){
				 				return 'He ';
				 			}else if(a=='å¥¹'){
				 				return 'She ';
				 			}else if(a=='He'){
								return 'He ';
							}else if(a=='She'){
								return 'She ';
							}
		}
					},
				//åŒ¹é…ç¿»è¯‘æ˜Ÿåº§ï¼Œåœ°åŒº
		 		translate: function(word,num,index) {
					if ($api.getStorage("language") == "zho") {
					chat.translateLang='zh';
					 }else{
					chat.translateLang='en';
				}
					if(word!=null&&word!=undefined){
					var content_no = word.replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g, " ");
					var salt = (new Date).getTime();
					var str1 = "20161226000034707" + content_no + salt + "i1XmNFcDa7_Z4i6jUSZA"; //æœ€åè¿™ä¸ªç­¾åçš„å­—ç¬¦ä¸²è¿™ä¸ªå¯è®©å›½é™…è¡¨æƒ…è¿›è¡Œå¿½ç•¥åç¿»è¯‘çš„
					var sign = MD5(str1);
						$.ajax({
								url: 'http://api.fanyi.baidu.com/api/trans/vip/translate',
								type: 'post',
								dataType: 'json',
								async:true,
								data: {
									q: content_no,
									appid: "20161226000034707",
									salt: salt,
									from: "auto",
									to: chat.translateLang,
									sign: sign
								}
							})
							.done(function(data,err) {
								// alert(JSON.stringify(data));
								if(data && data['trans_result']) {
									if(num == 1){
										chat.messageArr[index].msg_body.extras.area=data.trans_result[0].dst;
									}else if(num == 2){
											chat.messageArr[index].msg_body.extras.constellation2=data.trans_result[0].dst;
									}else if(num == 3){
											chat.area=data.trans_result[0].dst;
										}else if(num == 4){
											chat.constellation2=data.trans_result[0].dst;
										}
								}
							})
							if(num == 1){
									return chat.messageArr[index].msg_body.extras.area;
							}else if(num ==2){
									return chat.messageArr[index].msg_body.extras.constellation2;
							}
			}else{
					return '';
				}
				// alert(chat.wenbenfanyi);
		},

					// å»ä»–çš„ä¸ªäººä¸»é¡µ
						openHome: function(targetId) {
							var this_ = this;
						// var winName =  "otherDetail/" + this_.members_int.nickname;
							api.openWin({
								name: "home",
								url: "widget://html/home/home.html",
								reload: true,
								vScrollBarEnabled: false,
								slidBackEnabled: false,
								pageParam:{
								otherId: targetId
							}
							});
							// api.closeFrame();
						},
					// test: function(a,index){
					// 	api.imageCache({
					// 	    url: a,
					// 	}, function(ret, err){
					// 	    if( ret ){
					// 				// alert(JSON.stringify(ret));
					// 	      chat.url = ret.url;
					// 	    }
					// 	});
					// 	// alert("test()çš„èµ‹å€¼"+url);
					// 			return chat.url;
					// },
					//ç‚¹å‡»æ’­æ”¾è¯­éŸ³
					xiazai:function(key,index,size){

						// console.log("keyå€¼");
						// alert("ç‚¹å‡»äº†è¯­éŸ³");
						// toggle2='';
       if(api.systemType == 'ios'){
				 audioStreamer.getVolume(function(ret) {

							if(ret.volume==0.0){
								api.toast({
										msg: 'æ‚¨å½“å‰ä¸ºé™éŸ³æ¨¡å¼å“¦',
										duration: 2000,
										location: 'bottom'
								});
							}
					});
		// 					audioStreamer.addEventListener({
		// }, function(ret) {
		// 		alert(JSON.stringify(ret));
		// 	toggle2=ret.state;
		// });


		 var	abin1=$(".message-wrap:eq("+index+") .abin1")[0];
		// alert(abin1);
		var		abin3=$(".message-wrap:eq("+index+") .abin3")[0];
		var  	lastabin1=$(".message-wrap:eq("+toggle1+") .abin1")[0]
		var		lastabin3=$(".message-wrap:eq("+toggle1+") .abin3")[0];

			if(toggle1!=index&&toggle1!=-1){

			$api.css(lastabin1,"display:none");
			$api.css(lastabin3,"display:block");
			}
			if(toggle1==index){
              api.stopPlay();
							// alert("åˆ°");
							//å¦‚æœè¯­éŸ³æ˜¯åœ¨æ’­æ”¾ä¸­çš„è¯å°±ç«‹é©¬å…³æ‰ï¼Œå¹¶è·³å‡ºæ–¹æ³•ï¼Œä¸æ‰§è¡Œä¸‹é¢çš„ æ’­å‘è¯­éŸ³
								if(toggle3=='prepare'){
									// alert("åˆ°2");
									$api.css(lastabin1,"display:none");
									$api.css(lastabin3,"display:block");

									api.stopPlay();
									toggle3='';
									return;
								}


			}
	  	toggle1=index;


				// alert("aa");
				api.download({
					url: 'http://bin.baopinghui.com/'+key,
					savePath: 'fs://media/'+key,
					cache: true,
					allowResume: true
				}, function(ret, err) {
					// alert(JSON.stringify(ret));
					if (ret.state == 1) {
						setTimeout(function(){
							$api.css(abin1,"display:none");
							$api.css(abin3,"display:block");


						},size*1000+500)
						$api.css(abin1,"display:block");
						$api.css(abin3,"display:none");
								toggle3='prepare';
						api.startPlay({
									path: 'fs://media/'+key
							}, function(ret, err) {
									if (ret) {
								 toggle3='';
										$api.css(abin1,"display:none");
										$api.css(abin3,"display:block");

									} else {
											// alert(JSON.stringify(err));
									}
							});

	}
});






			 }else{
				 //ç”³è¯·è·å–è®¿é—®èµ„æºæƒé™ï¼Œå¦‚æœå·²æœ‰ä¸ä¼šæœ‰å½±å“
				//  if(api.systemType=="android"){
					 	 fnrequestPermission("storage");
				//  }

				 audioStreamer.getVolume(function(ret) {

							if(ret.volume==0.0){
								api.toast({
										msg: 'æ‚¨å½“å‰ä¸ºé™éŸ³æ¨¡å¼å“¦',
										duration: 2000,
										location: 'bottom'
								});
							}
					});

							audioStreamer.addEventListener({
		}, function(ret) {
				// alert(JSON.stringify(ret));
			toggle2=ret.state;
		});


		 var	abin1=$(".message-wrap:eq("+index+") .abin1")[0];
		// alert(abin1);
		var		abin3=$(".message-wrap:eq("+index+") .abin3")[0];
		var  	lastabin1=$(".message-wrap:eq("+toggle1+") .abin1")[0]
		var		lastabin3=$(".message-wrap:eq("+toggle1+") .abin3")[0];

			if(toggle1!=index&&toggle1!=-1){

			$api.css(lastabin1,"display:none");
			$api.css(lastabin3,"display:block");
			}
			if(toggle1==index){

     //è¿™æ¬¡ç‚¹å‡»çš„çš„ä¿¡æ¯è·Ÿä¸Šä¸€æ¬¡ç‚¹å‡»çš„ä¿¡æ¯æ˜¯åŒä¸€æ¡ä¿¡æ¯,å…³æ‰æ’­æ”¾
							audioStreamer.stop();
					//å¦‚æœè¯­éŸ³æ˜¯åœ¨æ’­æ”¾ä¸­çš„è¯å°±ç«‹é©¬å…³æ‰ï¼Œå¹¶è·³å‡ºæ–¹æ³•ï¼Œä¸æ‰§è¡Œä¸‹é¢çš„ æ’­å‘è¯­éŸ³
						if(toggle2=='prepare'){
							$api.css(lastabin1,"display:none");
							$api.css(lastabin3,"display:block");

							audioStreamer.stop();
							toggle2='';
							return;
						}


			}
		toggle1=index;

		 setTimeout(function(){
			 $api.css(abin1,"display:none");
			 $api.css(abin3,"display:block");


		 },size*1000+200)

		api.download({
			url: 'http://bin.baopinghui.com/'+key,
			savePath: 'fs://media/'+key,
			cache: true,
			allowResume: true
		}, function(ret, err) {
			if (ret.state == 1) {

							audioStreamer.openPlayer({
				path:'fs://media/'+key,
				// path:'http://bin.baopinghui.com/'+key,
	}, function(ret) {
			if (ret.status) {
				$api.css(abin1,"display:block");
				$api.css(abin3,"display:none");
					// api.alert({ msg: JSON.stringify(ret) });
			}
	});

}
});




			 }


					},
					//å¤åˆ¶ç¿»è¯‘çš„æ–‡æœ¬
					copy:function(event,index){
						 var pagex=event.clientX;
						 var pagey=event.clientY;
						 // var pagey=event.pageY;
						 // alert(pagex);

						var fuzhi="";
						var fanyi="";
						var wangcheng="";

					//	chat.translateLang='en';
					if ($api.getStorage("language") == "zho") {
						fuzhi="å¤åˆ¶";
						fanyi="ç¿»è¯‘";
						fanyiyuyan="ç¿»è¯‘è¯­è¨€";
						wangcheng="å¤åˆ¶å®Œæˆ";

						if(typeof($api.getStorage('translateLangStorage')) != "undefined"){

							 chat.translateLang=$api.getStorage('translateLangStorage');

						 }else {
								 chat.translateLang='zh';
						 }
						// //alert("ä¸­");

					}else{
						fuzhi="copy";
						fanyi="translate";
						wangcheng="Copy complete";
						fanyiyuyan="translation language";

						if(typeof($api.getStorage('translateLangStorage')) != "undefined"){

							 chat.translateLang=$api.getStorage('translateLangStorage');

						 }else {
								 chat.translateLang='en';
						 }
					}



 // ä½¿ç”¨apiCloudå†’æ³¡æŒ‰é’®æ’ä»¶
						var bubbleMenu = api.require('bubbleMenu');

						bubbleMenu.open({
						style: {
									//  mask: '#FFF',
							maskColor:'rgba(0,0,0,0)',
							bgColor:'#000',
					lightColor:'#009acd',
					borderColor:'#000',
					cutLineColor:'#636363',
								// titleColor'#00':  //(å¯é€‰é¡¹)å­—ç¬¦ä¸²ç±»å‹ï¼›é®ç½©å±‚é¢˜è‰²ï¼Œæ”¯æŒ rgb,rgba,#ï¼›é»˜è®¤ï¼šrgba(0,0,0,0)
					cornerRadius: 8,  //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›åœ†è§’å¤§å°ï¼›é»˜è®¤ï¼š8
					arrowSize: 0,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›å°–è§’å¤§å°ï¼›é»˜è®¤ï¼š12
					titleSize: 14,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›æ ‡é¢˜å¤§å°ï¼šé»˜è®¤ï¼š14
					height: 50        //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›èœå•é«˜åº¦ï¼›é»˜è®¤ï¼š50
					},
								centerX: pagex,
								centerY: pagey+70,
								btnArray: [{
										title: fuzhi
								}],
								fixedOn: api.frameName
						}, function(ret, err) {
								if (ret.index==0) {
									var clipBoard = api.require('clipBoard');
							 clipBoard.set({
									 value: chat.messageArr[index].translated
							 }, function(ret, err) {
									 if (ret) {
											api.toast({
													msg: wangcheng,
													duration: 1000,
													location: 'center'
											});
									 } else {
											//  MNtoast('æ“ä½œå¤±è´¥')
									 }
							 });

						 }
						});




					},
					//ç‚¹å‡»èŠå¤©ä¿¡æ¯è¿›è¡Œç¿»è¯‘ï¼Œè·å–ç¼“å­˜ä¸­çš„è¦æ±‚ç¿»è¯‘è¯­è¨€ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ç¼“å­˜ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬è¯­è¨€
					translateLang3:function(index){



						if(typeof($api.getStorage('translateLangStorage')) != "undefined"){

							 chat.translateLang=$api.getStorage('translateLangStorage');

							}else{

										if ($api.getStorage("language") == "zho") {
										chat.translateLang='zh';

										 }else{
							// alert("è‹±");
							chat.translateLang='en';
						}
					}
							 //è°ƒç”¨ç™¾åº¦ç¿»è¯‘çš„æ¥å£
							translate(chat.messageArr[index].msg_body.text, chat.messageArr[index]);


				},

					gtouchstart:function gtouchstart(event,index,type){
						// var touch=event.touch[0];
						var centerX=event.changedTouches[0].pageX;
						var centerY=event.changedTouches[0].pageY;
						// alert(centerX);
					// 	// alert("å‰å®³");

					timeOutEvent = setTimeout(function(){
		 chat.longPress(index,centerX,centerY,type);
	 },500);//è¿™é‡Œè®¾ç½®å®šæ—¶å™¨ï¼Œå®šä¹‰é•¿æŒ‰500æ¯«ç§’è§¦å‘é•¿æŒ‰äº‹ä»¶ï¼Œæ—¶é—´å¯ä»¥è‡ªå·±æ”¹ï¼Œä¸ªäººæ„Ÿè§‰500æ¯«ç§’éå¸¸åˆé€‚
	//  alert(timeOutEvent);
						return false;
			},
						gtouchend:function gtouchend(index,event){
										clearTimeout(timeOutEvent);//æ¸…é™¤å®šæ—¶å™¨
										if(timeOutEvent!=0){
												//è¿™é‡Œå†™è¦æ‰§è¡Œçš„å†…å®¹ï¼ˆå°¤å¦‚onclickäº‹ä»¶ï¼‰
												// vm.goChat(item);
										}
										return false;
								},
								//å¦‚æœæ‰‹æŒ‡æœ‰ç§»åŠ¨ï¼Œåˆ™å–æ¶ˆæ‰€æœ‰äº‹ä»¶ï¼Œæ­¤æ—¶è¯´æ˜ç”¨æˆ·åªæ˜¯è¦ç§»åŠ¨è€Œä¸æ˜¯é•¿æŒ‰
								gtouchmove:function gtouchmove(){
										clearTimeout(timeOutEvent);//æ¸…é™¤å®šæ—¶å™¨
										timeOutEvent = 0;

								},

								//çœŸæ­£é•¿æŒ‰ååº”è¯¥æ‰§è¡Œçš„å†…å®¹
								longPress:function longPress(index,centerX,centerY,type){
									// alert("å‰å®³å§");
                 if(type==1){
			 			        	 chat.translateLang2(index,centerX,centerY);
			 					}else if(type==2){
			 						     chat.yuyin(index,centerX,centerY);

			 					}else if(type==3){
									//æ·»åŠ è¡¨æƒ…
										chat.emotion2(index,centerX,centerY);
								}



										timeOutEvent = 0;
										//æ‰§è¡Œé•¿æŒ‰è¦æ‰§è¡Œçš„å†…å®¹ï¼Œå¦‚å¼¹å‡ºèœå•
										// $api.css($api.dom('.Popup'), 'display:block');
								},
								emotion2: function(index,centerX,centerY){
									// ä½¿ç”¨apiCloudå†’æ³¡æŒ‰é’®æ’ä»¶
														 var x=centerX;
														 var y=centerY+70;
														 var title;
														 var imgUrl;
														 if($api.getStorage('language')=='zho'){
															 title="æ·»åŠ åˆ°è¡¨æƒ…åŒ…";
														 }else{
															 title="Add to warehouse";
														 }
														 var bubbleMenu = api.require('bubbleMenu');

														 bubbleMenu.open({
														 style: {
																	 //  mask: '#FFF',
															 maskColor:'rgba(0,0,0,0)',
															 bgColor:'#000',
													 lightColor:'#009acd',
													 borderColor:'#000',
													 cutLineColor:'#636363',
																 // titleColor'#00':  //(å¯é€‰é¡¹)å­—ç¬¦ä¸²ç±»å‹ï¼›é®ç½©å±‚é¢˜è‰²ï¼Œæ”¯æŒ rgb,rgba,#ï¼›é»˜è®¤ï¼šrgba(0,0,0,0)
													 cornerRadius: 8,  //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›åœ†è§’å¤§å°ï¼›é»˜è®¤ï¼š8
													 arrowSize:0,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›å°–è§’å¤§å°ï¼›é»˜è®¤ï¼š12
													 titleSize: 14,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›æ ‡é¢˜å¤§å°ï¼šé»˜è®¤ï¼š14
													 height: 50        //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›èœå•é«˜åº¦ï¼›é»˜è®¤ï¼š50
													 },
																 centerX: x,
																 centerY: y,
																 btnArray: [{title:title,length:120}]
																//  fixedOn: api.frameName
														 }, function(ret, err) {
															//  alert(JSON.stringify(ret))
																 if (ret.index==0) {
																	imgUrl=chat.messageArr[index].msg_body.text;
																		// alert(JSON.stringify(imgUrl));
																		if(chat.messageArr[index].msg_body.extras.fail=="1"){
																			api.toast({
																			    msg: 'å›¾ç‰‡æœªå‘é€æˆåŠŸï¼Œä¸èƒ½æ·»åŠ ',
																			    duration: 2000,
																			    location: 'bottom'
																			});
																			return;
																		}else{
																			console.log(imgUrl);
																	chat.addEmotion(imgUrl);
																}
															}
														 });
								},
								yuyin:function(index,centerX,centerY){
			 // ä½¿ç”¨apiCloudå†’æ³¡æŒ‰é’®æ’ä»¶
									var bubbleMenu = api.require('bubbleMenu');
									var btn=[{title: warn_text.tingtong},{title: warn_text.yangshengqi}];

									bubbleMenu.open({
									style: {
												//  mask: '#FFF',
										maskColor:'rgba(0,0,0,0)',
										bgColor:'#000',
								lightColor:'#009acd',
								borderColor:'#000',
								cutLineColor:'#636363',
											// titleColor'#00':  //(å¯é€‰é¡¹)å­—ç¬¦ä¸²ç±»å‹ï¼›é®ç½©å±‚é¢˜è‰²ï¼Œæ”¯æŒ rgb,rgba,#ï¼›é»˜è®¤ï¼šrgba(0,0,0,0)
								cornerRadius: 8,  //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›åœ†è§’å¤§å°ï¼›é»˜è®¤ï¼š8
								arrowSize: 0,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›å°–è§’å¤§å°ï¼›é»˜è®¤ï¼š12
								titleSize: 11,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›æ ‡é¢˜å¤§å°ï¼šé»˜è®¤ï¼š14
								height: 50        //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›èœå•é«˜åº¦ï¼›é»˜è®¤ï¼š50
								},
											centerX: centerX,
											centerY: centerY+70,
											btnArray:btn ,
											fixedOn: api.frameName
									}, function(ret, err) {
											if (ret.index==0) {
												audioStreamer.onCall();


								} else if(ret.index==1){

											 audioStreamer.onNormal();


											}
									});



						},
							translateLang2:function(index,centerX,centerY){
								var fuzhi="";
								var fanyi="";
								var wangcheng="";
								var fanyiyuyan="";
								var chexiao="";
							//	chat.translateLang='en';
							if ($api.getStorage("language") == "zho") {
								fuzhi="å¤åˆ¶";
								fanyi="ç¿»è¯‘";
								fanyiyuyan="ç¿»è¯‘è¯­è¨€";
								wangcheng="å¤åˆ¶å®Œæˆ";
								chexiao="æ’¤é”€";
								if(typeof($api.getStorage('translateLangStorage')) != "undefined"){

									 chat.translateLang=$api.getStorage('translateLangStorage');

								 } else {
										 chat.translateLang='zh';
								 }
								// alert("ä¸­");

							}else{
								fuzhi="copy";
								fanyi="translate";
								wangcheng="Copy complete";
								fanyiyuyan="translation language";
								chexiao="backout";


								if(typeof($api.getStorage('translateLangStorage')) != "undefined"){

									 chat.translateLang=$api.getStorage('translateLangStorage');

								 }else {
										 chat.translateLang='en';
								 }
							}
							var tbn=[];
							var x=centerX;
							var y=centerY+70;
							// if(type2==1){
							//   tbn=[{title: fuzhi},{title: chexiao},{title: fanyiyuyan}];
							// 	x=centerX-30;
							// }else{
								tbn=[{title: fuzhi},{title: fanyiyuyan}];
							// }

 // alert(tbn.length);

		 // ä½¿ç”¨apiCloudå†’æ³¡æŒ‰é’®æ’ä»¶
								var bubbleMenu = api.require('bubbleMenu');

								bubbleMenu.open({
								style: {
											//  mask: '#FFF',
									maskColor:'rgba(0,0,0,0)',
									bgColor:'#000',
							lightColor:'#009acd',
							borderColor:'#000',
							cutLineColor:'#636363',
										// titleColor'#00':  //(å¯é€‰é¡¹)å­—ç¬¦ä¸²ç±»å‹ï¼›é®ç½©å±‚é¢˜è‰²ï¼Œæ”¯æŒ rgb,rgba,#ï¼›é»˜è®¤ï¼šrgba(0,0,0,0)
							cornerRadius: 8,  //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›åœ†è§’å¤§å°ï¼›é»˜è®¤ï¼š8
							arrowSize:0,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›å°–è§’å¤§å°ï¼›é»˜è®¤ï¼š12
							titleSize: 14,    //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›æ ‡é¢˜å¤§å°ï¼šé»˜è®¤ï¼š14
							height: 50        //(å¯é€‰é¡¹)æ•°å­—ç±»å‹ï¼›èœå•é«˜åº¦ï¼›é»˜è®¤ï¼š50
							},
										centerX: x,
										centerY: y,
										btnArray: tbn,
										fixedOn: api.frameName
								}, function(ret, err) {
									// alert(JSON.stringify(ret))
										if (ret.index==0) {
											// alert(tbn.length);
											//å¤åˆ¶æ¶ˆæ¯æ–‡æœ¬
															var clipBoard = api.require('clipBoard');
													 clipBoard.set({
															 value: chat.messageArr[index].msg_body.text
													 }, function(ret, err) {
															 if (ret) {
																	api.toast({
																			msg: wangcheng,
																			duration: 1000,
																			location: 'center'
																	});
															 } else {
																	//  MNtoast('æ“ä½œå¤±è´¥')
															 }
													 });

								 } else if(ret.index==1&&tbn.length==3) { //ç‚¹å‡»äº†æ¶ˆæ¯æ’¤å›

																			// translate(chat.messageArr[index].msg_body.text, chat.messageArr[index]);
										}else if((ret.index==1&&tbn.length==2)||(ret.index==2&&tbn.length==3)){


											api.openWin({

										name:'recommend_list3',
										url: '../chat/recommend_list3.html',
											 // "chat/chat2.html"
											// url:router['widget']+"group/group_chat.html",
										slidBackEnabled: false,
										animation: {
											type: "fade", //åŠ¨ç”»ç±»å‹ï¼ˆè¯¦è§åŠ¨ç”»ç±»å‹å¸¸é‡ï¼‰
											subType: "fade", //åŠ¨ç”»å­ç±»å‹ï¼ˆè¯¦è§åŠ¨ç”»å­ç±»å‹å¸¸é‡ï¼‰
											duration: 250 //åŠ¨ç”»è¿‡æ¸¡æ—¶é—´ï¼Œé»˜è®¤300æ¯«ç§’
										},
										pageParam: {

									translateLang:chat.translateLang


											}
										});


										}
								});



					},
					//è¿›å…¥ä¸ªäººé¡µ
					clcikHeader: function() {
					//translate(this.messageArr[index].msg_body.text, this.messageArr[index]);
					// openPersonal(api.winName, this.targetId);
					api.openWin({
					    name: 'homepage',
					    url: '../home/homepage.html',
					    pageParam: {
					        uid: otherId
					    }
					});

					},
					//æ›´å¤š
					moreList: function(isClsoe) {
						alert("i love baopinghui");
						// if(isClsoe == 'close') {
						// 	this.moreListShow = false;
						// 	UIChatBox.show();
						// } else {
						// 	this.moreListShow = true;
						// 	UIChatBox.hide();
						// }
					},
					//é€‰æ‹©è¯­è¨€
					selectLang: function(lang) {
						this.translateLang = lang;
						this.moreListShow = false;
						UIChatBox.show();
						msgToTop();
					},
					dispnone: function() {
						this.moreListShow = false;
						UIChatBox.show();
					},
					//è¿”å›é”®
					closed: function() {
						UIChatBox.value(function(ret, err) {
						if (ret) {
							//è®¾ç½®ç¼“å­˜è‰ç¨¿

								$api.rmStorage(singlesendtext);
								$api.setStorage(singlesendtext, ret.msg);

						}
				});
				api.sendEvent({
					name: 'loginIM',
					extra: {
						key1: api.pageParam['uiId'], //åˆ«äººçš„id
						key2: msgContent, //
						key3: time,
						key4: from_id,
						key5:api.pageParam['avatar'],
						key6:api.pageParam['nickname']


					}
				});
						api.closeWin({
							animation: {
								type: "push", //åŠ¨ç”»ç±»å‹ï¼ˆè¯¦è§åŠ¨ç”»ç±»å‹å¸¸é‡ï¼‰
								subType: "from_left", //åŠ¨ç”»å­ç±»å‹ï¼ˆè¯¦è§åŠ¨ç”»å­ç±»å‹å¸¸é‡ï¼‰
								duration: 300 //åŠ¨ç”»è¿‡æ¸¡æ—¶é—´ï¼Œé»˜è®¤300æ¯«ç§’
							}
						});



	// api.openWin({
	//     name: 'index',
	//     url: './index.html',
	//
	// });



						//å‘é€å¹¿æ’­ï¼Œé‡æ–°ç™»å½•

					},
					showMessage: function(mess) {
						return chat.transEmotion(mess);
					},
					showMessage2: function(mess) {
						return mess.translated;
					},
					showMessagetime:function(time,index){
					return	chat.change2(time,index);

					},
					//æ‰“å¼€å›¾ç‰‡
					sacnImage: function(imageUrl) {
						// var img=new Image();
						// img.src=imageUrl;
						// alert(img.width+"::"+img.height);

						// imageBrowser.openImages({
						// 	showList: false,
						// 	imageUrls: [
						// 		imageUrl
						// 	]
						// });
							api.openWin({
									name: 'im',
									url: './imgBrowser.html',
									pageParam: {
											isrc: imageUrl
									}
							});
					},
					//è½¬æ¢emotion æŠŠå¸¦è¡¨æƒ…æ ‡è¯†çš„æ–‡æœ¬æ¶ˆæ¯è§£ææˆè¡¨æƒ…åŠ æ–‡æœ¬
					transEmotion: function(mess) {
						var reg = /\[(.*?)\]/gm;
						var transMsg = mess.msg_body.text.replace(reg, function(match) {
							for(var i = 0, len = emotionArr.length; i < len; i++) {
								if(match == emotionArr[i]['text']) {
									var path = api.wgtRootDir + '/image/emotion/' + emotionArr[i]['name'] + '.png';
									return '<img width="20" height="20" src="' + path + '" />'
								}
							}
						});
						if(mess.from_id == this.ownId&&mess.msg_body.extras.type!="txt2") { //åŒ¹é…çš„æ—¶å€™åˆ«äººçš„æ¶ˆæ¯ä¼šå‡ºç°æ‰“é’© å»æ‰
							if(mess.msg_body.extras.fail!=null&&mess.msg_body.extras.fail=="1"){
								return transMsg + '<img width="20" height="20" class="send" src="../../icon/messages/loading.gif" />';
							}else{
							return transMsg + '<img width="15" height="15" class="send" src="../../icon/messages/send2.png" />';
							}
						} else {
							return transMsg;
						}

					},

					//è·å–å†å²æ¶ˆæ¯
					getHistroy: function() {
						// chat.SmessageArr=chat.SmessageArr.concat(chat.SmessageArr);
					var this_ = this;
					var sj3=(typeof($api.getStorage(SMessages))!="undefined"&&JSON.stringify(chat.SmessageArr) != '[]')?change1((chat.SmessageArr[chat.SmessageArr.length-1].msg_ctime),1000):(sj2+" 00:00:00");
						api.ajax({
							url: 'https://report.im.jpush.cn/v2/users/' + this_.ownId + '/messages?count=1000&begin_time=' + sj3 + ' 00:00:00&end_time=' + sj + ' 23:59:59',
							encode: true,
							method: 'get',
							headers: {
								'Authorization': 'Basic ' + par,
								'Content-Type': 'application/json;charset=utf-8'
							}
						}, function(ret, err) {
                // alert(JSON.stringify(ret.messages));
							if(ret) {

							// alert(JSON.stringify(chat.SmessageArr.length));
								if(sj3==(sj2+" 00:00:00")){
									  continuegain=true;
    console.log("æ²¡æœ‰ç¼“å†²è¿›è¡Œæ‹¿ä¿¡æ¯ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥");

                chat.SmessageArr=ret.messages;




								}else{
									var a,b,c;
                  // console.log("aaass"+chat.SmessageArr[0]);
									if(chat.SmessageArr[chat.SmessageArr.length-1]!=null){
											a=chat.SmessageArr[chat.SmessageArr.length-1].msgid;
									}
									if(chat.SmessageArr[chat.SmessageArr.length-2]!=null){
										b=chat.SmessageArr[chat.SmessageArr.length-2].msgid;
									}
									if(chat.SmessageArr[chat.SmessageArr.length-3]!=null){
											c=chat.SmessageArr[chat.SmessageArr.length-3].msgid;
									}
									// console.log("æ‰€å‘ç”Ÿçš„"+chat.SmessageArr);
		console.log("å·²æœ‰ç¼“å†²è¿›è¡Œæ‹¿æ–°ä¿¡æ¯ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥");
											for(var i = 0; i < ret.messages.length; i++) {
															 if(ret.messages[i].msgid==b||ret.messages[i].msgid==a||ret.messages[i].msgid==c){
																//  alert("aa");
																 continue;
															 }
														chat.SmessageArr.push(ret.messages[i]);

											}


								}


								// var a=JSON.stringify(chat.SmessageArr);
								if(chat.SmessageArr.length>3000){
									chat.SmessageArr.splice(0,chat.SmessageArr.length-3000);
								}

						         $api.setStorage(SMessages, chat.SmessageArr);
									// console.log("è®¾ç½®ç¼“å­˜"+JSON.stringify(chat.SmessageArr));
					for(var i = 0; i < chat.SmessageArr.length; i++) {
						if((chat.SmessageArr[i].from_id == chat.targetId && chat.SmessageArr[i].target_id == chat.ownId) || (chat.SmessageArr[i].from_id == chat.ownId && chat.SmessageArr[i].target_id == chat.targetId)) {
							Vue.set(chat.SmessageArr[i],'translated',"");

							chat.messageArr.push(chat.SmessageArr[i]);
						}
					}

								// for(var i = 0; i < ret.messages.length; i++) {
								// 	if((ret.messages[i].from_id == chat.targetId && ret.messages[i].target_id == chat.ownId) || (ret.messages[i].from_id == chat.ownId && ret.messages[i].target_id == chat.targetId)) {
								// 		ret.messages[i].translated = '';
								// 		chat.messageArr.push(ret.messages[i]);
								// 	}
								// }
					                 //  msg_body.extras.type
								this_.cursor = ret.cursor; //æ‹¿åˆ°æ ‡è¯†

								if(this_.cursor !== "" && ret.count == 1000) {
									//ç»§ç»­è·å–æ¶ˆæ¯
					            	chat.Continue_getHistroy(this_.ownId,this_.cursor);

								}
								msgToTop();
								chat.isLoading = false;
								//åŠ è½½å†å²åï¼Œæ˜¾ç¤ºåœ¨æœ€åº•éƒ¨
								setTimeout(function(){
									msgToTop();
								},1000);
								//æŠŠè‰ç¨¿æ·»åŠ åˆ°è¾“å…¥æ¡†
								UIChatBox.value({
						 msg: $api.getStorage(singlesendtext)

		 });
							} else {
								//åŠ è½½å†å²åï¼Œæ˜¾ç¤ºåœ¨æœ€åº•éƒ¨
								  if(err.code==899002){
										//è¯¥ç”¨æˆ·ä¸åœ¨æå…‰çš„ç”¨æˆ·è¡¨ä¸­ï¼Œè¿›è¡Œè‡ªåŠ¨æ³¨å†Œ
										api.ajax({
												url: 'http://api.baopinghui.com/jpushim/findnewbin11',
												method: 'get',
												data: {
														values: {
																user: api.pageParam['uiId']
														}
												}
										},function(ret1, err){
												if (ret1) {
														// alert("æˆåŠŸ");
												//æˆåŠŸè‡ªåŠ¨åˆ·æ–°å½“å‰é¡µé¢
													history.go(0);

												} else {

												}
										});

									}
										msgToTop();
								chat.isLoading = false;
								// api.alert({
								// 	msg: JSON.stringify(err)
								// });
							}
						});

					},
					Continue_getHistroy: function(ownId,cursor) {
						var this_ = this;
						api.ajax({
							url: 'https://report.im.jpush.cn/v2/users/' + ownId + '/messages?cursor=' + cursor,
							method: 'get',
							headers: {
								'Authorization': 'Basic ' + par,
								'Content-Type': 'application/json;charset=utf-8'
							}
						}, function(ret, err) {
							if(ret) {
								//api.alert({ msg: JSON.stringify(ret) });
								if(ret.count === 0) {
									return;
								}
								for(var i = 0; i < ret.messages.length; i++) {
									// if((ret.messages[i].from_id == chat.targetId && ret.messages[i].target_id == chat.ownId) || (ret.messages[i].from_id == chat.ownId && ret.messages[i].target_id == chat.targetId)) {
									// 	ret.messages[i].translated = '';
										// chat.messageArr.push(ret.messages[i]);
										chat.SmessageArr.push(ret.messages[i]);
									// }
								}
								  //  console.log("*******************lalalalal******"+chat.SmessageArr.length);
                    // var a=JSON.stringify(chat.SmessageArr);
										if(chat.SmessageArr.length>3000){
											chat.SmessageArr.splice(0,chat.SmessageArr.length-3000);
										}
              	$api.setStorage(SMessages, chat.SmessageArr);
									// console.log("è®¾ç½®ç¼“å­˜"+JSON.stringify(chat.SmessageArr));
								for(var i = 0; i < chat.SmessageArr.length; i++) {
									if((chat.SmessageArr[i].from_id == chat.targetId && chat.SmessageArr[i].target_id == chat.ownId) || (chat.SmessageArr[i].from_id == chat.ownId && chat.SmessageArr[i].target_id == chat.targetId)) {

				          	Vue.set(chat.SmessageArr[i],'translated',"");
										chat.messageArr.push(chat.SmessageArr[i]);
									}
								}

								this_.cursor = ret.cursor; //æ‹¿åˆ°æ ‡è¯†
								//å¦‚æœè¿˜æœ‰æœªæ‹¿å®Œçš„æ•°æ®-é‚£å°±ç»§ç»­æ‹¿
										if(this_.cursor !== "" && ret.count == 1000) {

		            				chat.Continue_getHistroy(this_.ownId,this_.cursor);
								}
								setTimeout(function(){
									msgToTop();
								},50);
							} else {
								// api.alert({
								// 	msg: JSON.stringify(err)
								// });
							}
						});
					},
					getHistroy2: function(){

					var uuid=$api.getStorage('id'); //è‡ªå·±çš„id
					var otherId=api.pageParam['uiId'];//å½“å‰èŠå¤©å¯¹è±¡çš„id
					var aa=new Date().getTime();
					console.log("æ—¶é—´å¼€å§‹:::::::::::::::"+(aa-start));
					var selectSql="from tin_im_message where userid in ('"+uuid+"','"+otherId+"') and from_id in ('"+uuid+"','"+otherId+"') and target_id in ('"+uuid+"','"+otherId+"')";
						var msgs=db.selectSqlSync({
								name: 'tinkle',
								sql: "select * "+selectSql+" order by ctime_ms desc limit "+(chat.number-chat.number_stage)+","+chat.number_stage
								// sql:"select * from tin_im_message where userid='sdfasdfasdf'"

						});

						console.log(":::::::::::::::::::::"+((new Date().getTime())-aa));
						// alert(JSON.stringify(msgs));
						     msgs.data.reverse();//å€’åº

						// alert(JSON.stringify(msgs));
						for(var i=0;i<msgs.data.length;i++){
								 msgs.data[i].msg_body=JSON.parse(msgs.data[i].msg_body.replace(/&prime;/g,"'"));
								 msgs.data[i].create_time=Number(msgs.data[i].create_time);
								 msgs.data[i].translated="";
						}
						chat.messageArr=msgs.data;
							msgToTop();
							// return;
				var lastMessage=db.selectSqlSync({
						name: 'tinkle',
						sql: "select *,(select count(userid) "+selectSql+") as count from tin_im_message where userid='"+uuid+"' order by ctime_ms desc limit 0,1 "
				});
			// alert(JSON.stringify(lastMessage));

							chat.isLoading = false; //å…³é—­åŠ è½½è½¬åœˆ
							var	count=0;
				var sj3=(lastMessage.data.length>0)?change1((Number(lastMessage.data[0].ctime_ms)),1000):(sj2+" 00:00:00");
			     if(lastMessage.data.length>0){
						 count=lastMessage.data[0].count;
					 }
				// alert(sj3);
				console.log("è·å–å‰:::::::::::::::::::"+(new Date-aa));
				var aa2=new Date();
				api.ajax({
					url: 'https://report.im.jpush.cn/v2/users/' + uuid + '/messages?count=1000&begin_time=' + sj3 + ' 00:00:00&end_time=' + sj + ' 23:59:59',
					encode: true,
					method: 'get',
					headers: {
						'Authorization': 'Basic ' + par,
						'Content-Type': 'application/json;charset=utf-8'
					}
				},function(ret, err){
						if (ret) {
						  // alert(JSON.stringify(ret));
							// alert(JSON.stringify(ret.messages.length));
							// return;
							 var tempMessages=[];
							if(ret.messages.length>chat.number){

					var  bb= new Date();
					console.log("è·å–æ¶ˆæ¯ç»“æŸ:::::::::"+(bb-aa2));

								// alert(JSON.stringify(ret.messages));
								for(var i =0; i < ret.messages.length; i++) {
									if((ret.messages[i].from_id == chat.targetId && ret.messages[i].target_id == chat.ownId) || (ret.messages[i].from_id == chat.ownId && ret.messages[i].target_id == chat.targetId)) {
										// Vue.set(ret.messages[i],'translated',"");
									  ret.messages[i].translated="";
										tempMessages.push(ret.messages[i]);

									}
								}
						console.log("è€—æ—¶::::"+(new Date()-bb));
                          if(tempMessages.length>=chat.number){
														chat.messageArr=tempMessages.slice(tempMessages.length-chat.number, tempMessages.length);
													}else{
														chat.messageArr=tempMessages;
													}
													msgToTop();

					 console.log("æ€»è€—æ—¶::::"+(new Date()-start));


									}
									// return;
							ret.messages=ret.messages.concat(tempMs);

							if(ret.messages.length>0){
					          setTimeout(function(){
											console.log("å•èŠæ¶ˆæ¯åŠ å…¥æ•°æ®åº“");

											insermessage(ret.messages,db);
                     if(tempMessages.length<chat.number&&tempMessages.length>0){
											 console.log("è¿›å…¥ç›´æ¥è¦†ç›–æŸ¥è¯¢");
											 	chat.addMessage(uuid,otherId,count,2);//ä¼ å…¥2ä»£è¡¨ç›´æ¥è¦†ç›–å†å²æ¶ˆæ¯
										 }else{
											 chat.addMessage(uuid,otherId,count);
										 }


										},10)

							}
							api.sendEvent({ //å‘é€æ¸…ç©ºchatlist é¡µé¢ä¸­çš„tempMs
									name: 'clear_tempMs',
									extra: {
											statu: "tempMs",
									}
							});
							$api.setStorage('tempMs', []);


							if(ret.cursor !== "" && ret.count == 500){
								chat.Continue_getHistroy2(ret.cursor,uuid,otherId,count);
							}

					 } else {

				}
		});
},
					Continue_getHistroy2:function(cursor,uuid,otherId,count){
						api.ajax({
							url: 'https://report.im.jpush.cn/v2/users/' + uuid + '/messages?cursor=' + cursor,
							method: 'get',
							headers: {
								'Authorization': 'Basic ' + par,
								'Content-Type': 'application/json;charset=utf-8'
							}
						},function(ret, err){
								if (ret) {
									var tempMessages=[];
								 if(ret.messages.length>chat.number){
									 // alert(JSON.stringify(ret.messages));
														 for(var i =0; i < ret.messages.length; i++) {
															 if((ret.messages[i].from_id == chat.targetId && ret.messages[i].target_id == chat.ownId) || (ret.messages[i].from_id == chat.ownId && ret.messages[i].target_id == chat.targetId)) {
																 // Vue.set(ret.messages[i],'translated',"");
																 ret.messages[i].translated="";
																 tempMessages.push(ret.messages[i]);

															 }
														 }

														 if(tempMessages.length>=chat.number){
															 chat.messageArr=tempMessages.slice(tempMessages.length-chat.number, tempMessages.length);
														 }else{
															 chat.messageArr=tempMessages;
														 }
														 msgToTop();

										 }
										 // return

								 if(ret.messages.length>0){
											 setTimeout(function(){
												 console.log("å•èŠæ¶ˆæ¯åŠ å…¥æ•°æ®åº“");

												 insermessage(ret.messages,db);
												if(tempMessages.length<chat.number&&tempMessages.length>0){
													console.log("è¿›å…¥ç›´æ¥è¦†ç›–æŸ¥è¯¢");
													 chat.addMessage(uuid,otherId,count,2);//ä¼ å…¥2ä»£è¡¨ç›´æ¥è¦†ç›–å†å²æ¶ˆæ¯
												}else{
													chat.addMessage(uuid,otherId,count);
												}


											 },10)

								 }
											if(ret.cursor !== "" && ret.count == 1000){
										chat.Continue_getHistroy2(ret.cursor,uuid,otherId,count);
									}
								} else {
										alert( JSON.stringify( err ) );
								}
						});


					},
					addMessage:function(uuid,otherId,count,statu){
						// var indexValue=chat.messageArr.length;
						db.selectSql({
											name: 'tinkle',
											sql: "select * from tin_im_message where userid in ('"+uuid+"','"+otherId+"') and from_id in ('"+uuid+"','"+otherId+"') and target_id in ('"+uuid+"','"+otherId+"') order by ctime_ms asc limit "+count+",10000"
						}, function(msgs2,err){
								if( msgs2.status ){
									console.log("æ›´æ–°æ•°æ®æˆåŠŸ");
									// console.log("æ•°æ®å†…å®¹"+JSON.stringify(ret));
											// alert(JSON.stringify(msgs2));
										var 	this_number=chat.number;
                        chat.number+=msgs2.data.length;
											for(var i=0;i<msgs2.data.length;i++){
													 msgs2.data[i].msg_body=JSON.parse(msgs2.data[i].msg_body.replace(/&prime;/g,"'"));
													 msgs2.data[i].create_time=Number(msgs2.data[i].create_time);
													 msgs2.data[i].translated="";
											}
											// alert(JSON.stringify(msgs2));

											setTimeout(function(){
												if(statu == 2){  //ç›´æ¥è¦†ç›–
													// console.log("è¦†ç›–æ¶ˆæ¯æ‰§è¡Œ"+msgs2.data.length);
													chat.messageArr=msgs2.data;
												}else{
													// alert("aa");
														chat.messageArr= chat.messageArr.concat(msgs2.data);
												}

												if(chat.messageArr.length>this_number){  //å¦‚æœæ¶ˆæ¯å¤ªå¤šåˆ™å‰ªåˆ‡åˆ°è§„å®šçš„é•¿åº¦
														chat.messageArr=chat.messageArr.slice(chat.messageArr.length-this_number, chat.messageArr.length);
														chat.number=this_number;
												}
													msgToTop();
											},100)


									}else{
										alert( JSON.stringify( err ) );
								}
						});
					},
					created: function() {
						this.getHistroy2();
					},

			//æ¶ˆæ¯å‘é€å¤±è´¥æ—¶ä¿¡æ¯å­˜å‚¨é‡å‘çš„å®ä½“
			failSendMessageBody:function(msgContext,type,state,duration,gid,avatar_url,nickname,data,ownHead){
				//å°è£…æˆåŸå…ˆæ¶ˆæ¯ä½“çš„æ ¼å¼è¿™æ ·æ‰å¯ä»¥è®©vue æ¸²æŸ“å‡ºæ¥
				               var create_time=new Date();

												var contentfail={};
													 contentfail.target_type="single";
													 contentfail.from_id=$api.getStorage('id');
													 contentfail.target_id=chat.targetId;
													 contentfail.msg_type="text";
													 contentfail.create_time=create_time.getTime();
													var msg_body={};
														msg_body.text=msgContext;
														var extras={};
														extras.type=type;
														extras.fail="1";
														extras.duration=duration;
														extras.gid=gid;
														extras.avatar_url=avatar_url;
														extras.nickname=nickname;
														extras.data=data;
														extras.ownHead = ownHead;
														msg_body.extras=extras;
													 contentfail.msg_body=msg_body;
													 contentfail.translated="";

												var failMessages={};
														failMessages.type=type;
														failMessages.duration=duration;
														failMessages.text=msgContext;
														failMessages.index=chat.messageArr.length;
														chat.messageArr.push(contentfail);
														failS.push(failMessages);
														// setTimeout(function(){
															msgToTop();
														// },200);


			},
			//ç”¨äºè½¬æ¢åˆ¤æ–­æ˜¾ç¤ºæ—¶é—´
		change2:function(number,index){
				// alert(number);
				// number1= parseInt(number);
        // var toggle5=true;//ç”¨æ¥åˆ¤æ–­8åˆ†é’Ÿå†…çš„æ—¶é—´æ˜¯æ˜¯å¦æ˜¾ç¤º
					var msg_time;
					if(number.toString().length<13){
						number=number*1000;
					}
					// var realTime;
					var now=new Date();

					if((number-chat.messageArr[toggle6].create_time)<=8*60*1000&&index!=0&&index!=toggle6){
						return "";
					}else{
	         toggle6=index;
					}

				function timestampToTime(realTime,nowTime) {
								var date = new Date(realTime);//æ—¶é—´æˆ³ä¸º10ä½éœ€*1000ï¼Œæ—¶é—´æˆ³ä¸º13ä½çš„è¯ä¸éœ€ä¹˜1000

								Y = date.getFullYear() + '-';
								M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
								D = date.getDate() + ' ';
								h = date.getHours() + ':';
								m = date.getMinutes() < 10 ? ('0'+date.getMinutes()) : (date.getMinutes()+'');
								s = date.getSeconds();
								Y1 = nowTime.getFullYear() + '-';
								M1 = (nowTime.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
								D1 = nowTime.getDate() + ' ';
								D2 = nowTime.getDate()-1 + ' ';

								if((Y+M+D)==(Y1+M1+D1)){
									return h+m;
								}
								// else if((Y+M+D)==(Y1+M1+D2)){
								// 	return "æ˜¨å¤© "+h+m;
								// }
								else{
									return Y+M+D+h+m;
								}



						}
							return timestampToTime(number,now);



			}

				}


			})
			//è¿›æ¥ç›´æ¥è·å–ç”¨æˆ·è¡¨æƒ…åŒ…
			// function getEmo(){
			// 	api.ajax({
			// 	    url: 'http://api.baopinghui.com/app_tinUserinfoControllerC/selectEmoji',
			// 	    method: 'post',
			// 	    data: {
			// 	        values: {
			// 	            uiid: chat.ownId
			// 	        }
			// 	    }
			// 	},function(ret, err){
			// 	    if (ret) {
			// 					var emoji=ret.data.emoji.split(",");
			// 	        chat.emotion=emoji;
			// 					chat.emotion.reverse();//ç¿»è½¬è¡¨æƒ…åŒ…æ•°ç»„ï¼Œè®©æ–°æ·»åŠ çš„é‚£ä¸ªè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®
			// 					// alert(JSON.stringify(chat.emotion));
			// 	    } else {
			// 	        alert( JSON.stringify( err ) );
			// 	    }
			// 	});
			//
			// }
			//é‡ç‚¹ç”³è¯·æƒé™
			function fnrequestPermission(string) {

				api.requestPermission({
						list: [string,"storage"],
				}, function(ret, err) {
							// if(ret.list[0].granted){
							//
							// }


				});
		}
		//æ‰“å¼€ç›¸å†Œå¹¶å‘é€
     function openAndsendPic(){
			 UIMediaScanner.open({
						type: 'picture',
						column: 4,
						classify: false,
						max: 2,
						sort: {
								key: 'time',
								order: 'desc'
						},
						texts: {
								stateText: 'å·²é€‰æ‹©*é¡¹',
								cancelText: 'å–æ¶ˆ',
								finishText: 'å®Œæˆ'
						},
						exchange: true,
						rotation: false,
						// showPreview:true
				}, function(ret) {
						if (ret) {
								// alert(JSON.stringify(ret.list[0].path));

								if(ret.eventType=='confirm'){
									// alert("è¿›äº†");
									for(var i=0;i<ret.list.length;i++){
											(function(i){
												UIMediaScanner.transPath({
																			path:ret.list[i].path
																	}, function(ret_, err) {
																			if (ret) {
																						// alert(JSON.stringify(ret_));
																					uploadPic(ret_.path);
																			} else {

																			}
																	});


											})(i)


									}


								}

						}
				});
		 }

		}

		    // function funActionSheet(){
		    //     api.actionSheet({
		    //         title: 'åº•éƒ¨å¼¹å‡ºæ¡†',
		    //         cancelTitle: 'å–æ¶ˆ',
		    //         destructiveTitle: 'çº¢è‰²è­¦å‘ŠæŒ‰é’®',
		    //         buttons: ['æŒ‰é’®1','æŒ‰é’®2','æŒ‰é’®3']
		    //     },function(ret,err){
		    //         // api.alert({
		    //         //     msg: 'ä½ åˆšç‚¹å‡»äº†'+ret.buttonIndex
		    //         // });
		    //     });
		    // }
				function change1(number,b){

						var msg_time;
						var realTime;
						var now=new Date();
					 var date=(now.getTime() - 6 * 24 * 3600 * 1000)/1000;
					//  alert("date"+JSON.stringify(date));


						 var timebin='';

						var number1=(number+"").substring(0,10);
							msg_time= parseInt(number1);


						//  alert("msg_time"+JSON.stringify(msg_time));
						realTime=(msg_time>=date)?msg_time:date;

					function timestampToTime(realTime) {
									var date = new Date(realTime*1000);//æ—¶é—´æˆ³ä¸º10ä½éœ€*1000ï¼Œæ—¶é—´æˆ³ä¸º13ä½çš„è¯ä¸éœ€ä¹˜1000
									Y = date.getFullYear() + '-';
									M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
									D = date.getDate() + ' ';
									h = date.getHours() + ':';
									m = date.getMinutes() + ':';
									s = date.getSeconds();
									timebin=Y+M+D+h+m+s;
								 //  //alert(timebin+h+m+s);
							}

							 timestampToTime(realTime);
							 return timebin;
							// alert(timebin);

				}

		//	ç”¨äºå®šæ—¶å™¨è°ƒç”¨
			function sendEmo(emo){
				var cdate=new Date().getTime();
				 // alert(cdate);
				 if($api.getStorage('language')=='zho'){
					 msgContent = "[è¡¨æƒ…]";
				 }else{
					 msgContent = "[Picture]";
				 }
				 time = cdate;
				 from_id = $api.getStorage("id");
				 var Cindex=chat.messageArr.length;
				chat.failSendMessageBody(emo,"img",1);
				//å‘é€äº‹åŠ¡é€šçŸ¥èŠå¤©åˆ—è¡¨å‘é€æ¶ˆæ¯
				api.sendEvent({    //å‘ç»™ chat_list é¡µé¢
						name: 'ChatListExec',
						extra: {
								targetType: "single",  //æ¥æºçš„ç±»å‹å•èŠç±»å‹ å¦å¤–ä¸€ç§æ˜¯ç¾¤èŠç±»å‹group
								target_username:chat.targetId,  //å•èŠçš„å¯¹è±¡æå…‰çš„usernameæ—¢tinkleçš„uiid
								content: emo,  //è¦å‘é€çš„æ¶ˆæ¯ä½“å†…å®¹
								type: 'img'     //å‘é€çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹
						}
				});

				api.sendEvent({
					name: 'loginIM',
					extra: {
						key1: api.pageParam['uiId'], //åˆ«äººçš„id
						key2: msgContent, //
						key3: time,
						key4: from_id,
						key5:api.pageParam['avatar'],
						key6:api.pageParam['nickname']
					}
				});
				//æ¥å—ä¸Šé¢å‘é€çš„ç»™chat_listäº‹åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒ
				api.addEventListener({
						name: 'ChatListExecReturn'
				}, function(ret, err){
						if( ret ){
								if(ret.value.state==1){ //å‘é€æˆåŠŸè¿”å›
									 console.log("å‘é€æ¶ˆæ¯æˆåŠŸ");
									if(chat.messageArr[Cindex-1] != null){                          //è¿™æ˜¯é˜²æ­¢ç”¨æˆ·ç‚¹å‡»å‘é€æ¶ˆæ¯è¿‡å¿«å‰é¢çš„è¿˜åœ¨è½¬åœˆ
										chat.messageArr[Cindex-1].msg_body.extras.fail="0"
									}
									if(chat.messageArr[Cindex-2] != null){
										chat.messageArr[Cindex-2].msg_body.extras.fail="0"
									}

										 chat.messageArr[Cindex].msg_body.extras.fail="0";   //å‘é€æ¶ˆæ¯æˆåŠŸæ˜¯æ¶ˆæ¯çš„åŠ è½½è½¬åœˆå»æ‰
										chat.messageArr[Cindex].msg_body.text=ret.value.text;
										 setTimeout(function() {
											 msgToTop();   //å›åˆ°æœ€åº•éƒ¨ï¼Œå› ä¸ºå‘é€å›¾çš„å¤§å°è¦ç‚¹æ—¶é—´è·å–
										 }, 500)
								}else if(ret.value.state==2){  //å‘é€å¤±è´¥ï¼Œå¯¹æ–¹æå…‰è´¦æˆ·ä¸å­˜åœ¨è¿›è¡Œæ³¨å†Œ

									history.go(0);
									 msgToTop();
							 }
						}else{
								 alert( JSON.stringify( err ) );
						}
				});
			}

			//ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
			function random(length) {
				var str = Math.random().toString(36).substr(2);
				if(str.length >= length) {
					return str.substr(0, length);
				}
				str += random(length - str.length);
				return str;
			}
			//è®©æ–°è·å–çš„æ•°æ®å¾€ä¸Šé¡¶
			function msgToTop() {
				Vue.nextTick(function() {
					$api.dom('.main').scrollTop = $api.dom('.main').scrollHeight;
				});
			}
	</script>
	<!-- <script src="../../script/jiguang.js" type="text/javascript" charset="utf-8"></script> -->

</html>
